<!doctype html>
<html class="js" lang="{{ request.locale.iso_code }}">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="theme-color" content="">
    <link rel="canonical" href="{{ canonical_url }}">

    {%- if settings.favicon != blank -%}
      <link rel="icon" type="image/png" href="{{ settings.favicon | image_url: width: 32, height: 32 }}">
    {%- endif -%}

    {%- unless settings.type_header_font.system? and settings.type_body_font.system? -%}
      <link rel="preconnect" href="https://fonts.shopifycdn.com" crossorigin>
    {%- endunless -%}

    <title>
      {{ page_title }}
      {%- if current_tags %} &ndash; tagged "{{ current_tags | join: ', ' }}"{% endif -%}
      {%- if current_page != 1 %} &ndash; Page {{ current_page }}{% endif -%}
      {%- unless page_title contains shop.name %} &ndash; {{ shop.name }}{% endunless -%}
    </title>

    {% if page_description %}
      <meta name="description" content="{{ page_description | escape }}">
    {% endif %}

    {% render 'meta-tags' %}

    <script src="{{ 'constants.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'pubsub.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'global.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'details-disclosure.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'details-modal.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'search-form.js' | asset_url }}" defer="defer"></script>

    {%- if settings.animations_reveal_on_scroll -%}
      <script src="{{ 'animations.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}

    {{ content_for_header }}

    <!-- Origin Theme Scripts -->
    <script src="{{ 'origin-theme.js' | asset_url }}" defer="defer"></script>

    {%- liquid
      assign body_font_bold = settings.type_body_font | font_modify: 'weight', 'bold'
      assign body_font_italic = settings.type_body_font | font_modify: 'style', 'italic'
      assign body_font_bold_italic = body_font_bold | font_modify: 'style', 'italic'
    %}

    {% style %}
      {{ settings.type_body_font | font_face: font_display: 'swap' }}
      {{ body_font_bold | font_face: font_display: 'swap' }}
      {{ body_font_italic | font_face: font_display: 'swap' }}
      {{ body_font_bold_italic | font_face: font_display: 'swap' }}
      {{ settings.type_header_font | font_face: font_display: 'swap' }}

      {% assign scheme_classes = '' %}
      {% for scheme in settings.color_schemes -%}
        {% assign scheme_classes = scheme_classes | append: ', .color-' | append: scheme.id %}
        {% if forloop.index == 1 -%}
          :root,
        {%- endif %}
        .color-{{ scheme.id }} {
          --color-background: {{ scheme.settings.background.red }},{{ scheme.settings.background.green }},{{ scheme.settings.background.blue }};
        {% if scheme.settings.background_gradient != empty %}
          --gradient-background: {{ scheme.settings.background_gradient }};
        {% else %}
          --gradient-background: {{ scheme.settings.background }};
        {% endif %}

        {% liquid
          assign background_color = scheme.settings.background
          assign background_color_brightness = background_color | color_brightness
          if background_color_brightness <= 26
            assign background_color_contrast = background_color | color_lighten: 50
          elsif background_color_brightness <= 65
            assign background_color_contrast = background_color | color_lighten: 5
          else
            assign background_color_contrast = background_color | color_darken: 25
          endif
        %}

        --color-foreground: {{ scheme.settings.text.red }},{{ scheme.settings.text.green }},{{ scheme.settings.text.blue }};
        --color-background-contrast: {{ background_color_contrast.red }},{{ background_color_contrast.green }},{{ background_color_contrast.blue }};
        --color-shadow: {{ scheme.settings.shadow.red }},{{ scheme.settings.shadow.green }},{{ scheme.settings.shadow.blue }};
        --color-button: {{ scheme.settings.button.red }},{{ scheme.settings.button.green }},{{ scheme.settings.button.blue }};
        --color-button-text: {{ scheme.settings.button_label.red }},{{ scheme.settings.button_label.green }},{{ scheme.settings.button_label.blue }};
        --color-secondary-button: {{ scheme.settings.background.red }},{{ scheme.settings.background.green }},{{ scheme.settings.background.blue }};
        --color-secondary-button-text: {{ scheme.settings.secondary_button_label.red }},{{ scheme.settings.secondary_button_label.green }},{{ scheme.settings.secondary_button_label.blue }};
        --color-link: {{ scheme.settings.secondary_button_label.red }},{{ scheme.settings.secondary_button_label.green }},{{ scheme.settings.secondary_button_label.blue }};
        --color-badge-foreground: {{ scheme.settings.text.red }},{{ scheme.settings.text.green }},{{ scheme.settings.text.blue }};
        --color-badge-background: {{ scheme.settings.background.red }},{{ scheme.settings.background.green }},{{ scheme.settings.background.blue }};
        --color-badge-border: {{ scheme.settings.text.red }},{{ scheme.settings.text.green }},{{ scheme.settings.text.blue }};
        --payment-terms-background-color: rgb({{ scheme.settings.background.rgb }});
      }
      {% endfor %}

      {{ scheme_classes | prepend: 'body' }} {
        color: rgba(var(--color-foreground), 0.75);
        background-color: rgb(var(--color-background));
      }

      :root {
        --font-body-family: {{ settings.type_body_font.family }}, {{ settings.type_body_font.fallback_families }};
        --font-body-style: {{ settings.type_body_font.style }};
        --font-body-weight: {{ settings.type_body_font.weight }};
        --font-body-weight-bold: {{ settings.type_body_font.weight | plus: 300 | at_most: 1000 }};

        --font-heading-family: {{ settings.type_header_font.family }}, {{ settings.type_header_font.fallback_families }};
        --font-heading-style: {{ settings.type_header_font.style }};
        --font-heading-weight: {{ settings.type_header_font.weight }};

        --font-body-scale: {{ settings.body_scale | divided_by: 100.0 }};
        --font-heading-scale: {{ settings.heading_scale | times: 1.0 | divided_by: settings.body_scale }};

        --media-padding: {{ settings.media_padding }}px;
        --media-border-opacity: {{ settings.media_border_opacity | divided_by: 100.0 }};
        --media-border-width: {{ settings.media_border_thickness }}px;
        --media-radius: {{ settings.media_radius }}px;
        --media-shadow-opacity: {{ settings.media_shadow_opacity | divided_by: 100.0 }};
        --media-shadow-horizontal-offset: {{ settings.media_shadow_horizontal_offset }}px;
        --media-shadow-vertical-offset: {{ settings.media_shadow_vertical_offset }}px;
        --media-shadow-blur-radius: {{ settings.media_shadow_blur }}px;
        --media-shadow-visible: {% if settings.media_shadow_opacity > 0 %}1{% else %}0{% endif %};

        --page-width: {{ settings.page_width | divided_by: 10 }}rem;
        --page-width-margin: {% if settings.page_width == '1600' %}2{% else %}0{% endif %}rem;

        --product-card-image-padding: {{ settings.card_image_padding | divided_by: 10.0 }}rem;
        --product-card-corner-radius: {{ settings.card_corner_radius | divided_by: 10.0 }}rem;
        --product-card-text-alignment: {{ settings.card_text_alignment }};
        --product-card-border-width: {{ settings.card_border_thickness | divided_by: 10.0 }}rem;
        --product-card-border-opacity: {{ settings.card_border_opacity | divided_by: 100.0 }};
        --product-card-shadow-opacity: {{ settings.card_shadow_opacity | divided_by: 100.0 }};
        --product-card-shadow-visible: {% if settings.card_shadow_opacity > 0 %}1{% else %}0{% endif %};
        --product-card-shadow-horizontal-offset: {{ settings.card_shadow_horizontal_offset | divided_by: 10.0 }}rem;
        --product-card-shadow-vertical-offset: {{ settings.card_shadow_vertical_offset | divided_by: 10.0 }}rem;
        --product-card-shadow-blur-radius: {{ settings.card_shadow_blur | divided_by: 10.0 }}rem;

        --collection-card-image-padding: {{ settings.collection_card_image_padding | divided_by: 10.0 }}rem;
        --collection-card-corner-radius: {{ settings.collection_card_corner_radius | divided_by: 10.0 }}rem;
        --collection-card-text-alignment: {{ settings.collection_card_text_alignment }};
        --collection-card-border-width: {{ settings.collection_card_border_thickness | divided_by: 10.0 }}rem;
        --collection-card-border-opacity: {{ settings.collection_card_border_opacity | divided_by: 100.0 }};
        --collection-card-shadow-opacity: {{ settings.collection_card_shadow_opacity | divided_by: 100.0 }};
        --collection-card-shadow-visible: {% if settings.collection_card_shadow_opacity > 0 %}1{% else %}0{% endif %};
        --collection-card-shadow-horizontal-offset: {{ settings.collection_card_shadow_horizontal_offset | divided_by: 10.0 }}rem;
        --collection-card-shadow-vertical-offset: {{ settings.collection_card_shadow_vertical_offset | divided_by: 10.0 }}rem;
        --collection-card-shadow-blur-radius: {{ settings.collection_card_shadow_blur | divided_by: 10.0 }}rem;

        --blog-card-image-padding: {{ settings.blog_card_image_padding | divided_by: 10.0 }}rem;
        --blog-card-corner-radius: {{ settings.blog_card_corner_radius | divided_by: 10.0 }}rem;
        --blog-card-text-alignment: {{ settings.blog_card_text_alignment }};
        --blog-card-border-width: {{ settings.blog_card_border_thickness | divided_by: 10.0 }}rem;
        --blog-card-border-opacity: {{ settings.blog_card_border_opacity | divided_by: 100.0 }};
        --blog-card-shadow-opacity: {{ settings.blog_card_shadow_opacity | divided_by: 100.0 }};
        --blog-card-shadow-visible: {% if settings.blog_card_shadow_opacity > 0 %}1{% else %}0{% endif %};
        --blog-card-shadow-horizontal-offset: {{ settings.blog_card_shadow_horizontal_offset | divided_by: 10.0 }}rem;
        --blog-card-shadow-vertical-offset: {{ settings.blog_card_shadow_vertical_offset | divided_by: 10.0 }}rem;
        --blog-card-shadow-blur-radius: {{ settings.blog_card_shadow_blur | divided_by: 10.0 }}rem;

        --badge-corner-radius: {{ settings.badge_corner_radius | divided_by: 10.0 }}rem;

        --popup-border-width: {{ settings.popup_border_thickness }}px;
        --popup-border-opacity: {{ settings.popup_border_opacity | divided_by: 100.0 }};
        --popup-corner-radius: {{ settings.popup_corner_radius }}px;
        --popup-shadow-opacity: {{ settings.popup_shadow_opacity | divided_by: 100.0 }};
        --popup-shadow-horizontal-offset: {{ settings.popup_shadow_horizontal_offset }}px;
        --popup-shadow-vertical-offset: {{ settings.popup_shadow_vertical_offset }}px;
        --popup-shadow-blur-radius: {{ settings.popup_shadow_blur }}px;

        --drawer-border-width: {{ settings.drawer_border_thickness }}px;
        --drawer-border-opacity: {{ settings.drawer_border_opacity | divided_by: 100.0 }};
        --drawer-shadow-opacity: {{ settings.drawer_shadow_opacity | divided_by: 100.0 }};
        --drawer-shadow-horizontal-offset: {{ settings.drawer_shadow_horizontal_offset }}px;
        --drawer-shadow-vertical-offset: {{ settings.drawer_shadow_vertical_offset }}px;
        --drawer-shadow-blur-radius: {{ settings.drawer_shadow_blur }}px;

        --spacing-sections-desktop: {{ settings.spacing_sections }}px;
        --spacing-sections-mobile: {% if settings.spacing_sections < 24 %}{{ settings.spacing_sections }}{% else %}{{ settings.spacing_sections | times: 0.7 | round | at_least: 20 }}{% endif %}px;

        --grid-desktop-vertical-spacing: {{ settings.spacing_grid_vertical }}px;
        --grid-desktop-horizontal-spacing: {{ settings.spacing_grid_horizontal }}px;
        --grid-mobile-vertical-spacing: {{ settings.spacing_grid_vertical | divided_by: 2 }}px;
        --grid-mobile-horizontal-spacing: {{ settings.spacing_grid_horizontal | divided_by: 2 }}px;

        --text-boxes-border-opacity: {{ settings.text_boxes_border_opacity | divided_by: 100.0 }};
        --text-boxes-border-width: {{ settings.text_boxes_border_thickness }}px;
        --text-boxes-radius: {{ settings.text_boxes_radius }}px;
        --text-boxes-shadow-opacity: {{ settings.text_boxes_shadow_opacity | divided_by: 100.0 }};
        --text-boxes-shadow-visible: {% if settings.text_boxes_shadow_opacity > 0 %}1{% else %}0{% endif %};
        --text-boxes-shadow-horizontal-offset: {{ settings.text_boxes_shadow_horizontal_offset }}px;
        --text-boxes-shadow-vertical-offset: {{ settings.text_boxes_shadow_vertical_offset }}px;
        --text-boxes-shadow-blur-radius: {{ settings.text_boxes_shadow_blur }}px;

        --buttons-radius: {{ settings.buttons_radius }}px;
        --buttons-radius-outset: {% if settings.buttons_radius > 0 %}{{ settings.buttons_radius | plus: settings.buttons_border_thickness }}{% else %}0{% endif %}px;
        --buttons-border-width: {% if settings.buttons_border_opacity > 0 %}{{ settings.buttons_border_thickness }}{% else %}0{% endif %}px;
        --buttons-border-opacity: {{ settings.buttons_border_opacity | divided_by: 100.0 }};
        --buttons-shadow-opacity: {{ settings.buttons_shadow_opacity | divided_by: 100.0 }};
        --buttons-shadow-visible: {% if settings.buttons_shadow_opacity > 0 %}1{% else %}0{% endif %};
        --buttons-shadow-horizontal-offset: {{ settings.buttons_shadow_horizontal_offset }}px;
        --buttons-shadow-vertical-offset: {{ settings.buttons_shadow_vertical_offset }}px;
        --buttons-shadow-blur-radius: {{ settings.buttons_shadow_blur }}px;
        --buttons-border-offset: {% if settings.buttons_radius > 0 or settings.buttons_shadow_opacity > 0 %}0.3{% else %}0{% endif %}px;

        --inputs-radius: {{ settings.inputs_radius }}px;
        --inputs-border-width: {{ settings.inputs_border_thickness }}px;
        --inputs-border-opacity: {{ settings.inputs_border_opacity | divided_by: 100.0 }};
        --inputs-shadow-opacity: {{ settings.inputs_shadow_opacity | divided_by: 100.0 }};
        --inputs-shadow-horizontal-offset: {{ settings.inputs_shadow_horizontal_offset }}px;
        --inputs-margin-offset: {% if settings.inputs_shadow_vertical_offset != 0 and settings.inputs_shadow_opacity > 0 %}{{ settings.inputs_shadow_vertical_offset | abs }}{% else %}0{% endif %}px;
        --inputs-shadow-vertical-offset: {{ settings.inputs_shadow_vertical_offset }}px;
        --inputs-shadow-blur-radius: {{ settings.inputs_shadow_blur }}px;
        --inputs-radius-outset: {% if settings.inputs_radius > 0 %}{{ settings.inputs_radius | plus: settings.inputs_border_thickness }}{% else %}0{% endif %}px;

        --variant-pills-radius: {{ settings.variant_pills_radius }}px;
        --variant-pills-border-width: {{ settings.variant_pills_border_thickness }}px;
        --variant-pills-border-opacity: {{ settings.variant_pills_border_opacity | divided_by: 100.0 }};
        --variant-pills-shadow-opacity: {{ settings.variant_pills_shadow_opacity | divided_by: 100.0 }};
        --variant-pills-shadow-horizontal-offset: {{ settings.variant_pills_shadow_horizontal_offset }}px;
        --variant-pills-shadow-vertical-offset: {{ settings.variant_pills_shadow_vertical_offset }}px;
        --variant-pills-shadow-blur-radius: {{ settings.variant_pills_shadow_blur }}px;
      }

      *,
      *::before,
      *::after {
        box-sizing: inherit;
      }

      html {
        box-sizing: border-box;
        font-size: calc(var(--font-body-scale) * 62.5%);
        height: 100%;
      }

      body {
        display: grid;
        grid-template-rows: auto auto 1fr auto;
        grid-template-columns: 100%;
        min-height: 100%;
        margin: 0;
        font-size: 1.5rem;
        letter-spacing: 0.06rem;
        line-height: calc(1 + 0.8 / var(--font-body-scale));
        font-family: var(--font-body-family);
        font-style: var(--font-body-style);
        font-weight: var(--font-body-weight);
      }

      @media screen and (min-width: 750px) {
        body {
          font-size: 1.6rem;
        }
      }
    {% endstyle %}

    {{ 'base.css' | asset_url | stylesheet_tag }}
    {{ 'origin.css' | asset_url | stylesheet_tag }}
    <link rel="stylesheet" href="{{ 'component-cart-items.css' | asset_url }}" media="print" onload="this.media='all'">

    {%- if settings.cart_type == 'drawer' -%}
      {{ 'component-cart-drawer.css' | asset_url | stylesheet_tag }}
      {{ 'component-cart.css' | asset_url | stylesheet_tag }}
      {{ 'component-totals.css' | asset_url | stylesheet_tag }}
      {{ 'component-price.css' | asset_url | stylesheet_tag }}
      {{ 'component-discounts.css' | asset_url | stylesheet_tag }}
    {%- endif -%}

    {%- unless settings.type_body_font.system? -%}
      {% comment %}theme-check-disable AssetPreload{% endcomment %}
      <link rel="preload" as="font" href="{{ settings.type_body_font | font_url }}" type="font/woff2" crossorigin>
      {% comment %}theme-check-enable AssetPreload{% endcomment %}
    {%- endunless -%}
    {%- unless settings.type_header_font.system? -%}
      {% comment %}theme-check-disable AssetPreload{% endcomment %}
      <link rel="preload" as="font" href="{{ settings.type_header_font | font_url }}" type="font/woff2" crossorigin>
      {% comment %}theme-check-enable AssetPreload{% endcomment %}
    {%- endunless -%}

    {%- if localization.available_countries.size > 1 or localization.available_languages.size > 1 -%}
      {{ 'component-localization-form.css' | asset_url | stylesheet_tag: preload: true }}
      <script src="{{ 'localization-form.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}

    {%- if settings.predictive_search_enabled -%}
      <link
        rel="stylesheet"
        href="{{ 'component-predictive-search.css' | asset_url }}"
        media="print"
        onload="this.media='all'"
      >
    {%- endif -%}

    <script>
      if (Shopify.designMode) {
        document.documentElement.classList.add('shopify-design-mode');
      }
    </script>
    {%- render 'foxify-head' -%}
  </head>

  <body class="gradient{% if settings.animations_hover_elements != 'none' %} animate--hover-{{ settings.animations_hover_elements }}{% endif %}">
    {% sections 'foxify-header-group' %}
    <a class="skip-to-content-link button visually-hidden" href="#MainContent">
      {{ 'accessibility.skip_to_text' | t }}
    </a>

    {%- if settings.cart_type == 'drawer' -%}
      {%- render 'cart-drawer' -%}
    {%- endif -%}

    {% sections 'header-group' %}

    <main id="MainContent" class="content-for-layout focus-none" role="main" tabindex="-1">
      {{ content_for_layout }}
    </main>

    {% sections 'footer-group' %}

    <ul hidden>
      <li id="a11y-refresh-page-message">{{ 'accessibility.refresh_page' | t }}</li>
      <li id="a11y-new-window-message">{{ 'accessibility.link_messages.new_window' | t }}</li>
    </ul>

    <script>
      window.shopUrl = '{{ request.origin }}';
      window.routes = {
        cart_add_url: '{{ routes.cart_add_url }}',
        cart_change_url: '{{ routes.cart_change_url }}',
        cart_update_url: '{{ routes.cart_update_url }}',
        cart_url: '{{ routes.cart_url }}',
        predictive_search_url: '{{ routes.predictive_search_url }}',
      };

      window.cartStrings = {
        error: `{{ 'sections.cart.cart_error' | t }}`,
        quantityError: `{{ 'sections.cart.cart_quantity_error_html' | t: quantity: '[quantity]' }}`,
      };

      window.variantStrings = {
        addToCart: `{{ 'products.product.add_to_cart' | t }}`,
        soldOut: `{{ 'products.product.sold_out' | t }}`,
        unavailable: `{{ 'products.product.unavailable' | t }}`,
        unavailable_with_option: `{{ 'products.product.value_unavailable' | t: option_value: '[value]' }}`,
      };

      window.quickOrderListStrings = {
        itemsAdded: `{{ 'sections.quick_order_list.items_added.other' | t: quantity: '[quantity]' }}`,
        itemAdded: `{{ 'sections.quick_order_list.items_added.one' | t: quantity: '[quantity]' }}`,
        itemsRemoved: `{{ 'sections.quick_order_list.items_removed.other' | t: quantity: '[quantity]' }}`,
        itemRemoved: `{{ 'sections.quick_order_list.items_removed.one' | t: quantity: '[quantity]' }}`,
        viewCart: `{{- 'sections.quick_order_list.view_cart' | t -}}`,
        each: `{{- 'sections.quick_order_list.each' | t: money: '[money]' }}`,
        min_error: `{{- 'sections.quick_order_list.min_error' | t: min: '[min]' }}`,
        max_error: `{{- 'sections.quick_order_list.max_error' | t: max: '[max]' }}`,
        step_error: `{{- 'sections.quick_order_list.step_error' | t: step: '[step]' }}`,
      };

      window.accessibilityStrings = {
        imageAvailable: `{{ 'products.product.media.image_available' | t: index: '[index]' }}`,
        shareSuccess: `{{ 'general.share.success_message' | t }}`,
        pauseSlideshow: `{{ 'sections.slideshow.pause_slideshow' | t }}`,
        playSlideshow: `{{ 'sections.slideshow.play_slideshow' | t }}`,
        recipientFormExpanded: `{{ 'recipient.form.expanded' | t }}`,
        recipientFormCollapsed: `{{ 'recipient.form.collapsed' | t }}`,
        countrySelectorSearchCount: `{{ 'localization.country_results_count' | t: count: '[count]' }}`,
      };
    </script>
    <!-- Header Search Event Listener moved to origin-theme.js -->
    <!-- Origin Scripts moved to origin-theme.js -->
    <button type="button" class="origin-back-to-top" aria-label="Back to top">
      <svg
        aria-hidden="true"
        focusable="false"
        role="presentation"
        class="icon icon-caret"
        viewBox="0 0 10 6"
        style="transform: rotate(180deg); width: 14px; height: 14px; fill: currentColor;"
      >
        <path fill-rule="evenodd" clip-rule="evenodd" d="M9.354.646a.5.5 0 00-.708 0L5 4.293 1.354.646a.5.5 0 00-.708.708l4 4a.5.5 0 00.708 0l4-4a.5.5 0 000-.708z" fill="currentColor">
      </svg>
    </button>

    <!-- Back to top logic moved to origin-theme.js -->

    {%- if settings.predictive_search_enabled -%}
      <script src="{{ 'predictive-search.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}

    {%- if settings.cart_type == 'drawer' -%}
      <script src="{{ 'cart-drawer.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}
    {%- render 'foxify-footer' -%}
    {% sections 'foxify-footer-group' %}
    {%- render 'global-custom-cursor' -%}
    {% if request.page_type == 'product' %}
      <script src="https://cdn.tailwindcss.com" defer></script>
      <script src="https://unpkg.com/lucide@latest" defer></script>

      <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap');

        #fit-guide-container {
          font-family: 'Inter', sans-serif;
        }
        #fit-guide-modal {
          transition:
            opacity 0.3s ease,
            visibility 0.3s ease;
        }
        #fit-guide-modal.hidden-modal {
          opacity: 0;
          visibility: hidden;
          pointer-events: none;
        }
        #fit-guide-modal.visible-modal {
          opacity: 1;
          visibility: visible;
          pointer-events: auto;
        }

        .fade-in {
          animation: fadeIn 0.4s ease-out forwards;
        }
        .slide-up {
          animation: slideUp 0.4s ease-out forwards;
        }

        @keyframes fadeIn {
          from {
            opacity: 0;
          }
          to {
            opacity: 1;
          }
        }
        @keyframes slideUp {
          from {
            opacity: 0;
            transform: translateY(10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        /* Custom Scrollbar */
        #fit-guide-container ::-webkit-scrollbar {
          width: 8px;
          height: 8px;
        }
        #fit-guide-container ::-webkit-scrollbar-track {
          background: #1e293b;
        }
        #fit-guide-container ::-webkit-scrollbar-thumb {
          background: #475569;
          border-radius: 4px;
        }
        #fit-guide-container ::-webkit-scrollbar-thumb:hover {
          background: #64748b;
        }
      </style>

      <!-- TRIGGER BUTTON -->
      <button
        id="fit-guide-trigger"
        onclick="toggleFitGuide()"
        class="fixed bottom-6 right-6 z-[9990] bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-6 rounded-full shadow-2xl flex items-center gap-2 transition-all hover:scale-105 group"
      >
        <i data-lucide="ruler" class="w-5 h-5"></i>
        <span>Fit Guide</span>
        <span class="absolute -top-1 -right-1 flex h-3 w-3">
          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-indigo-400 opacity-75"></span>
          <span class="relative inline-flex rounded-full h-3 w-3 bg-indigo-500"></span>
        </span>
      </button>

      <!-- MODAL WRAPPER -->
      <div id="fit-guide-modal" class="hidden-modal fixed inset-0 z-[10000] flex items-center justify-center">
        <!-- BACKDROP -->
        <div class="absolute inset-0 bg-slate-900/90 backdrop-blur-sm" onclick="toggleFitGuide()"></div>

        <!-- CONTENT -->
        <div
          id="fit-guide-container"
          class="relative z-10 w-full max-w-6xl h-[90vh] bg-slate-900 border border-slate-700 rounded-3xl shadow-2xl overflow-hidden flex flex-col mx-4 md:mx-0 transform transition-all duration-300 scale-100"
        >
          <!-- CLOSE BUTTON -->
          <button
            onclick="toggleFitGuide()"
            class="absolute top-4 right-4 z-50 p-2 bg-slate-800 hover:bg-slate-700 rounded-full text-slate-400 hover:text-white transition-colors"
          >
            <i data-lucide="x" class="w-6 h-6"></i>
          </button>

          <!-- SCROLLABLE CONTENT AREA -->
          <div class="overflow-y-auto p-4 md:p-8 h-full">
            <header class="mb-8 md:mb-10 flex flex-col md:flex-row md:items-end justify-between gap-6 pr-12">
              <div>
                <h1 class="text-4xl md:text-5xl font-black text-white tracking-tight mb-2 bg-gradient-to-r from-indigo-300 via-white to-indigo-300 text-transparent bg-clip-text">
                  Fit Guide.
                </h1>
                <p class="text-slate-400 text-lg">Universal standard sizing reference.</p>
              </div>

              <div class="relative w-full md:w-64 z-40">
                <button
                  id="category-trigger"
                  class="flex items-center justify-between w-full bg-slate-800 hover:bg-slate-700 border border-slate-700 p-4 rounded-xl transition-all shadow-lg text-left group"
                >
                  <div class="flex items-center gap-3">
                    <div class="p-2 bg-indigo-500/20 rounded-lg" id="active-icon-container"></div>
                    <div>
                      <span class="text-xs text-slate-500 uppercase font-bold tracking-wider">Category</span>
                      <div class="text-white font-bold" id="category-title">Jackets</div>
                    </div>
                  </div>
                  <i
                    data-lucide="chevron-down"
                    class="w-5 h-5 text-slate-400 transition-transform"
                    id="chevron-icon"
                  ></i>
                </button>

                <div
                  id="category-menu"
                  class="hidden absolute top-full left-0 w-full mt-2 bg-slate-800 border border-slate-700 rounded-xl shadow-2xl overflow-hidden z-50"
                ></div>
              </div>
            </header>

            <main class="grid grid-cols-1 lg:grid-cols-12 gap-8 fade-in">
              <div class="lg:col-span-8 space-y-6">
                <div class="flex flex-col sm:flex-row justify-between items-center gap-4 bg-slate-900/50 p-4 rounded-2xl border border-slate-800">
                  <div class="flex bg-slate-800 p-1 rounded-xl" id="gender-toggles">
                    <button
                      data-cat="men"
                      class="px-6 py-2 rounded-lg font-bold text-sm transition-all duration-300 capitalize bg-indigo-500 text-white shadow-lg"
                    >
                      Men
                    </button>
                    <button
                      data-cat="women"
                      class="px-6 py-2 rounded-lg font-bold text-sm transition-all duration-300 capitalize text-slate-400 hover:text-white"
                    >
                      Women
                    </button>
                  </div>

                  <button
                    id="unit-toggle"
                    class="flex items-center gap-3 bg-slate-800 hover:bg-slate-700 px-5 py-2.5 rounded-xl border border-slate-700 transition-colors group"
                  >
                    <span id="label-cm" class="font-bold text-white">CM</span>
                    <i
                      data-lucide="arrow-right-left"
                      class="w-4 h-4 text-indigo-400 group-hover:rotate-180 transition-transform"
                    ></i>
                    <span id="label-in" class="font-bold text-slate-500">IN</span>
                  </button>
                </div>

                <div class="overflow-hidden rounded-2xl border border-slate-700 bg-slate-800/50 shadow-2xl backdrop-blur-sm">
                  <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                      <thead
                        class="bg-slate-900/80 text-xs uppercase tracking-wider text-slate-400 border-b border-slate-700"
                        id="table-head"
                      ></thead>
                      <tbody class="text-sm font-medium" id="table-body"></tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div class="lg:col-span-4 space-y-6">
                <div class="bg-gradient-to-br from-slate-800 to-slate-900 p-6 rounded-3xl border border-slate-700 shadow-xl overflow-hidden relative">
                  <h3 class="text-lg font-bold text-white mb-6 relative z-10">Measurement Guide</h3>

                  <div
                    id="visual-svg-container"
                    class="w-full max-w-[220px] mx-auto aspect-square relative z-10 mb-4 flex items-center justify-center"
                  ></div>

                  <div id="visual-instructions" class="space-y-3 relative z-10"></div>
                </div>

                <div class="bg-slate-900 rounded-2xl p-6 border border-slate-700 shadow-xl">
                  <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <i data-lucide="sparkles" class="w-5 h-5 text-yellow-400"></i>
                    Smart Finder
                  </h3>
                  <div class="flex flex-col gap-4">
                    <div>
                      <label id="calc-label" class="text-slate-400 text-sm mb-1 block">Your Measurement</label>
                      <div class="flex gap-2">
                        <input
                          id="calc-input"
                          type="text"
                          class="w-full bg-slate-800 text-white border border-slate-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 outline-none transition-all"
                          placeholder="Enter value..."
                        >
                        <button
                          id="calc-btn"
                          class="bg-indigo-500 hover:bg-indigo-400 text-white px-6 py-2 rounded-lg font-bold transition-colors shadow-lg"
                        >
                          Check
                        </button>
                      </div>
                    </div>

                    <div
                      id="calc-result"
                      class="hidden mt-2 bg-indigo-900/50 border border-indigo-500/30 p-4 rounded-xl flex items-start gap-3 slide-up"
                    >
                      <i data-lucide="check-circle" class="w-6 h-6 text-green-400 shrink-0 mt-0.5"></i>
                      <div>
                        <p id="res-msg" class="text-slate-200 text-sm">Perfect match found.</p>
                        <p id="res-size" class="text-2xl font-black text-white mt-1">L</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </main>

            <footer class="max-w-4xl mx-auto mt-16 text-center space-y-2 pb-8">
              <div class="flex items-center justify-center gap-2 text-slate-500 text-sm">
                <i data-lucide="help-circle" class="w-4 h-4"></i>
                <span id="footer-tip">If between sizes, always size up for comfort.</span>
              </div>
            </footer>
          </div>
        </div>
      </div>

      <script>
        // --- TOGGLE LOGIC ---
        function toggleFitGuide() {
          const modal = document.getElementById('fit-guide-modal');
          const isHidden = modal.classList.contains('hidden-modal');

          if (isHidden) {
            modal.classList.remove('hidden-modal');
            modal.classList.add('visible-modal');
            document.body.style.overflow = 'hidden'; // Lock scroll
          } else {
            modal.classList.remove('visible-modal');
            modal.classList.add('hidden-modal');
            document.body.style.overflow = ''; // Unlock scroll
          }
        }

        // --- DATA ---
        const DATA = {
          jackets: {
            title: 'Jackets & Outerwear',
            icon: 'layers',
            columns: [
              { key: 'label', label: 'Size' },
              { key: 'chest', label: 'Chest' },
              { key: 'sleeve', label: 'Sleeve' },
              { key: 'length', label: 'Length' },
            ],
            guides: [
              {
                key: 'chest',
                label: 'Chest',
                text: 'Measure around the fullest part of your chest, keeping tape horizontal.',
              },
              {
                key: 'sleeve',
                label: 'Sleeve',
                text: 'From center back of neck, over the shoulder, down to the wrist.',
              },
              {
                key: 'length',
                label: 'Length',
                text: 'From the highest point of the shoulder down to the bottom hem.',
              },
            ],
            ranges: {
              men: [
                {
                  label: 'XS',
                  chest_cm: '86-91',
                  chest_in: '34-36',
                  sleeve_cm: '81',
                  sleeve_in: '32',
                  length_cm: '66',
                  length_in: '26',
                },
                {
                  label: 'S',
                  chest_cm: '91-96',
                  chest_in: '36-38',
                  sleeve_cm: '82',
                  sleeve_in: '32.5',
                  length_cm: '68',
                  length_in: '27',
                },
                {
                  label: 'M',
                  chest_cm: '96-101',
                  chest_in: '38-40',
                  sleeve_cm: '84',
                  sleeve_in: '33',
                  length_cm: '70',
                  length_in: '27.5',
                },
                {
                  label: 'L',
                  chest_cm: '101-106',
                  chest_in: '40-42',
                  sleeve_cm: '86',
                  sleeve_in: '34',
                  length_cm: '72',
                  length_in: '28.5',
                },
                {
                  label: 'XL',
                  chest_cm: '106-111',
                  chest_in: '42-44',
                  sleeve_cm: '89',
                  sleeve_in: '35',
                  length_cm: '74',
                  length_in: '29',
                },
                {
                  label: 'XXL',
                  chest_cm: '111-116',
                  chest_in: '44-46',
                  sleeve_cm: '91',
                  sleeve_in: '36',
                  length_cm: '76',
                  length_in: '30',
                },
              ],
              women: [
                {
                  label: 'XS',
                  chest_cm: '78-82',
                  chest_in: '30-32',
                  sleeve_cm: '74',
                  sleeve_in: '29',
                  length_cm: '58',
                  length_in: '23',
                },
                {
                  label: 'S',
                  chest_cm: '82-86',
                  chest_in: '32-34',
                  sleeve_cm: '76',
                  sleeve_in: '30',
                  length_cm: '60',
                  length_in: '23.5',
                },
                {
                  label: 'M',
                  chest_cm: '86-91',
                  chest_in: '34-36',
                  sleeve_cm: '78',
                  sleeve_in: '30.5',
                  length_cm: '62',
                  length_in: '24.5',
                },
                {
                  label: 'L',
                  chest_cm: '91-96',
                  chest_in: '36-38',
                  sleeve_cm: '80',
                  sleeve_in: '31.5',
                  length_cm: '64',
                  length_in: '25',
                },
                {
                  label: 'XL',
                  chest_cm: '96-101',
                  chest_in: '38-40',
                  sleeve_cm: '82',
                  sleeve_in: '32',
                  length_cm: '66',
                  length_in: '26',
                },
              ],
            },
          },
          shirts: {
            title: 'T-Shirts & Tops',
            icon: 'shirt',
            columns: [
              { key: 'label', label: 'Size' },
              { key: 'chest', label: 'Chest' },
              { key: 'neck', label: 'Neck' },
            ],
            guides: [
              { key: 'chest', label: 'Chest', text: 'Measure under your arms around the fullest part of your chest.' },
              { key: 'neck', label: 'Neck', text: 'Measure around the base of your neck, leaving room for comfort.' },
            ],
            ranges: {
              men: [
                { label: 'XS', chest_cm: '81-86', chest_in: '32-34', neck_cm: '33-34', neck_in: '13-13.5' },
                { label: 'S', chest_cm: '86-91', chest_in: '34-36', neck_cm: '35-36', neck_in: '14-14.5' },
                { label: 'M', chest_cm: '96-101', chest_in: '38-40', neck_cm: '38-39', neck_in: '15-15.5' },
                { label: 'L', chest_cm: '106-111', chest_in: '42-44', neck_cm: '41-42', neck_in: '16-16.5' },
                { label: 'XL', chest_cm: '116-121', chest_in: '46-48', neck_cm: '43-44', neck_in: '17-17.5' },
              ],
              women: [
                { label: 'XS', chest_cm: '76-81', chest_in: '30-32', neck_cm: '30-31', neck_in: '12' },
                { label: 'S', chest_cm: '81-86', chest_in: '32-34', neck_cm: '32-33', neck_in: '13' },
                { label: 'M', chest_cm: '88-94', chest_in: '35-37', neck_cm: '34-35', neck_in: '13.5' },
                { label: 'L', chest_cm: '96-101', chest_in: '38-40', neck_cm: '36-37', neck_in: '14.5' },
              ],
            },
          },
          pants: {
            title: 'Pants & Trousers',
            icon: 'scissors',
            columns: [
              { key: 'label', label: 'Size' },
              { key: 'waist', label: 'Waist' },
              { key: 'hips', label: 'Hips' },
              { key: 'inseam', label: 'Std Inseam' },
            ],
            guides: [
              {
                key: 'waist',
                label: 'Waist',
                text: 'Measure around your natural waistline, usually near your bellybutton.',
              },
              { key: 'hips', label: 'Hips', text: 'Measure around the fullest part of your hips while standing.' },
              {
                key: 'inseam',
                label: 'Inseam',
                text: 'Measure from the crotch seam down the inside leg to the bottom hem.',
              },
            ],
            ranges: {
              men: [
                {
                  label: 'XS (28)',
                  waist_cm: '71',
                  waist_in: '28',
                  hips_cm: '86',
                  hips_in: '34',
                  inseam_cm: '76',
                  inseam_in: '30',
                },
                {
                  label: 'S (30)',
                  waist_cm: '76',
                  waist_in: '30',
                  hips_cm: '91',
                  hips_in: '36',
                  inseam_cm: '81',
                  inseam_in: '32',
                },
                {
                  label: 'M (32)',
                  waist_cm: '81',
                  waist_in: '32',
                  hips_cm: '97',
                  hips_in: '38',
                  inseam_cm: '81',
                  inseam_in: '32',
                },
                {
                  label: 'L (34)',
                  waist_cm: '86',
                  waist_in: '34',
                  hips_cm: '102',
                  hips_in: '40',
                  inseam_cm: '86',
                  inseam_in: '34',
                },
                {
                  label: 'XL (36)',
                  waist_cm: '91',
                  waist_in: '36',
                  hips_cm: '107',
                  hips_in: '42',
                  inseam_cm: '86',
                  inseam_in: '34',
                },
                {
                  label: 'XXL (38)',
                  waist_cm: '96',
                  waist_in: '38',
                  hips_cm: '112',
                  hips_in: '44',
                  inseam_cm: '86',
                  inseam_in: '34',
                },
              ],
              women: [
                {
                  label: 'XS',
                  waist_cm: '60-64',
                  waist_in: '24-25',
                  hips_cm: '86-89',
                  hips_in: '34-35',
                  inseam_cm: '76',
                  inseam_in: '30',
                },
                {
                  label: 'S',
                  waist_cm: '65-69',
                  waist_in: '26-27',
                  hips_cm: '90-94',
                  hips_in: '36-37',
                  inseam_cm: '76',
                  inseam_in: '30',
                },
                {
                  label: 'M',
                  waist_cm: '70-74',
                  waist_in: '28-29',
                  hips_cm: '95-99',
                  hips_in: '38-39',
                  inseam_cm: '79',
                  inseam_in: '31',
                },
                {
                  label: 'L',
                  waist_cm: '75-80',
                  waist_in: '30-31',
                  hips_cm: '100-104',
                  hips_in: '40-41',
                  inseam_cm: '79',
                  inseam_in: '31',
                },
              ],
            },
          },
          belts: {
            title: 'Belts',
            icon: 'circle',
            columns: [
              { key: 'label', label: 'Size' },
              { key: 'waist', label: 'Pant Waist' },
              { key: 'length', label: 'Belt Length' },
            ],
            guides: [
              { key: 'waist', label: 'Pant Waist', text: 'Based on the size of the pants you normally wear.' },
              { key: 'length', label: 'Belt Length', text: 'Measured from the buckle fold to the center hole.' },
            ],
            ranges: {
              men: [
                { label: 'S (30-32)', waist_in: '28-30', waist_cm: '71-76', length_in: '32-34', length_cm: '81-86' },
                { label: 'M (34-36)', waist_in: '32-34', waist_cm: '81-86', length_in: '36-38', length_cm: '91-96' },
                { label: 'L (38-40)', waist_in: '36-38', waist_cm: '91-96', length_in: '40-42', length_cm: '101-106' },
                {
                  label: 'XL (42-44)',
                  waist_in: '40-42',
                  waist_cm: '101-106',
                  length_in: '44-46',
                  length_cm: '111-116',
                },
              ],
              women: [
                { label: 'XS', waist_in: '24-26', waist_cm: '61-66', length_in: '30-32', length_cm: '76-81' },
                { label: 'S', waist_in: '28-30', waist_cm: '71-76', length_in: '34-36', length_cm: '86-91' },
                { label: 'M', waist_in: '32-34', waist_cm: '81-86', length_in: '38-40', length_cm: '96-101' },
                { label: 'L', waist_in: '36-38', waist_cm: '91-96', length_in: '42-44', length_cm: '106-112' },
              ],
            },
          },
          shoes: {
            title: 'Footwear',
            icon: 'footprints',
            columns: [
              { key: 'us', label: 'US' },
              { key: 'eu', label: 'EU' },
              { key: 'uk', label: 'UK' },
              { key: 'cm', label: 'CM' },
            ],
            guides: [
              {
                key: 'cm',
                label: 'Foot Length',
                text: 'Place foot on paper, mark heel and longest toe, then measure distance.',
              },
            ],
            ranges: {
              men: [
                { us: '7', eu: '40', uk: '6', cm: '25' },
                { us: '8', eu: '41', uk: '7', cm: '26' },
                { us: '9', eu: '42.5', uk: '8', cm: '27' },
                { us: '10', eu: '44', uk: '9', cm: '28' },
                { us: '11', eu: '45', uk: '10', cm: '29' },
                { us: '12', eu: '46', uk: '11', cm: '30' },
              ],
              women: [
                { us: '5', eu: '35', uk: '3', cm: '22' },
                { us: '6', eu: '36.5', uk: '4', cm: '23' },
                { us: '7', eu: '38', uk: '5', cm: '24' },
                { us: '8', eu: '39', uk: '6', cm: '25' },
                { us: '9', eu: '40.5', uk: '7', cm: '26' },
                { us: '10', eu: '42', uk: '8', cm: '27' },
              ],
            },
          },
        };

        // --- STATE ---
        let state = {
          activeTab: 'jackets',
          category: 'men', // men, women
          unit: 'cm',
          recommendedID: null,
          activeVisual: null,
          dropdownOpen: false,
        };

        // --- ELEMENTS ---
        const els = {
          categoryTrigger: document.getElementById('category-trigger'),
          categoryMenu: document.getElementById('category-menu'),
          categoryTitle: document.getElementById('category-title'),
          activeIconContainer: document.getElementById('active-icon-container'),
          chevron: document.getElementById('chevron-icon'),
          genderToggles: document.getElementById('gender-toggles'),
          unitToggle: document.getElementById('unit-toggle'),
          labelCm: document.getElementById('label-cm'),
          labelIn: document.getElementById('label-in'),
          tableHead: document.getElementById('table-head'),
          tableBody: document.getElementById('table-body'),
          svgContainer: document.getElementById('visual-svg-container'),
          instructionsContainer: document.getElementById('visual-instructions'),
          calcInput: document.getElementById('calc-input'),
          calcLabel: document.getElementById('calc-label'),
          calcBtn: document.getElementById('calc-btn'),
          calcResult: document.getElementById('calc-result'),
          resMsg: document.getElementById('res-msg'),
          resSize: document.getElementById('res-size'),
          footerTip: document.getElementById('footer-tip'),
        };

        // --- INITIALIZATION ---
        function init() {
          renderHeader();
          renderGender();
          renderUnit();
          renderTable();
          renderVisual();
          renderFooter();
          lucide.createIcons();
        }

        // --- RENDERERS ---

        function renderHeader() {
          // Setup active tab in Header
          const info = DATA[state.activeTab];
          els.categoryTitle.innerText = info.title;
          els.activeIconContainer.innerHTML = `<i data-lucide="${info.icon}" class="w-5 h-5 text-indigo-400"></i>`;

          // Build Dropdown
          els.categoryMenu.innerHTML = Object.entries(DATA)
            .map(([key, data]) => {
              const isActive = key === state.activeTab;
              return `
                      <button onclick="changeTab('${key}')" class="w-full flex items-center gap-3 p-4 hover:bg-slate-700 transition-colors border-b border-slate-700/50 last:border-0 ${isActive ? 'bg-slate-700/50' : ''}">
                          <i data-lucide="${data.icon}" class="w-5 h-5 ${isActive ? 'text-indigo-400' : 'text-slate-400'}"></i>
                          <span class="font-medium ${isActive ? 'text-white' : 'text-slate-300'}">${data.title}</span>
                      </button>
                  `;
            })
            .join('');
        }

        function renderGender() {
          Array.from(els.genderToggles.children).forEach((btn) => {
            const isSelected = btn.dataset.cat === state.category;
            btn.className = isSelected
              ? 'px-6 py-2 rounded-lg font-bold text-sm transition-all duration-300 capitalize bg-indigo-500 text-white shadow-lg'
              : 'px-6 py-2 rounded-lg font-bold text-sm transition-all duration-300 capitalize text-slate-400 hover:text-white';
          });
        }

        function renderUnit() {
          if (state.unit === 'cm') {
            els.labelCm.className = 'font-bold text-white';
            els.labelIn.className = 'font-bold text-slate-500';
          } else {
            els.labelIn.className = 'font-bold text-white';
            els.labelCm.className = 'font-bold text-slate-500';
          }

          // Update Calc Label
          let placeholder = 'Enter value...';
          if (state.activeTab === 'shoes') placeholder = 'US Size (e.g. 9)';
          else if (state.activeTab === 'pants' || state.activeTab === 'belts') placeholder = `Waist (${state.unit})`;
          else placeholder = `Chest (${state.unit})`;

          els.calcInput.placeholder = placeholder;
          els.calcLabel.innerText = placeholder.split('(')[0].trim();
        }

        function getCellValue(row, colKey) {
          if (['label', 'us', 'eu', 'uk'].includes(colKey)) return row[colKey];
          const suffix = state.unit === 'cm' ? '_cm' : '_in';
          // Try specific suffix first, then fallback to generic
          if (row[colKey + suffix]) return row[colKey + suffix];
          if (row[colKey]) return row[colKey]; // fallback
          if (state.unit === 'cm' && row.cm) return row.cm; // shoes fallback
          return '-';
        }

        function renderTable() {
          const info = DATA[state.activeTab];
          const rows = info.ranges[state.category] || info.ranges.men;

          // Header
          els.tableHead.innerHTML = `<tr>${info.columns
            .map(
              (col) => `
                  <th class="p-4 cursor-help hover:text-indigo-400 transition-colors" onmouseenter="setVisual('${col.key}')">
                      <div class="flex items-center gap-2">${col.label} <i data-lucide="info" class="w-3 h-3"></i></div>
                  </th>
              `,
            )
            .join('')}</tr>`;

          // Body
          els.tableBody.innerHTML = rows
            .map((row) => {
              // Check highlight
              let isRec = false;
              if (state.recommendedID) {
                if (state.activeTab === 'shoes') isRec = row.us === state.recommendedID;
                else isRec = row.label === state.recommendedID;
              }

              const rowClass = isRec
                ? 'bg-indigo-500/20 shadow-[inset_3px_0_0_0_#6366f1] transition-all duration-200 border-b border-slate-700/50'
                : 'transition-all duration-200 border-b border-slate-700/50 hover:bg-slate-700/30';

              const badgeClass = isRec
                ? 'bg-indigo-500 text-white shadow-lg shadow-indigo-500/40'
                : 'bg-slate-800 text-slate-300';

              return `<tr class="${rowClass}">
                      ${info.columns
                        .map((col, idx) => {
                          const val = getCellValue(row, col.key);
                          if (idx === 0) {
                            return `<td class="p-4 text-slate-200 font-mono text-base">
                                  <span class="inline-flex items-center justify-center min-w-[2.5rem] h-10 px-2 rounded-lg font-bold text-lg ${badgeClass} transition-all">${val}</span>
                              </td>`;
                          } else {
                            const unitLabel =
                              state.activeTab !== 'shoes' && col.key !== 'label'
                                ? `<span class="text-slate-500 text-xs ml-1">${state.unit}</span>`
                                : '';
                            return `<td class="p-4 text-slate-200 font-mono text-base">${val}${unitLabel}</td>`;
                          }
                        })
                        .join('')}
                  </tr>`;
            })
            .join('');

          lucide.createIcons();
        }

        function renderVisual() {
          // Instructions
          const info = DATA[state.activeTab];
          els.instructionsContainer.innerHTML = info.guides
            .map((guide) => {
              const isActive = state.activeVisual === guide.key;
              const borderClass = isActive
                ? 'bg-slate-700 border-indigo-500 shadow-lg'
                : 'bg-slate-800/50 border-transparent hover:bg-slate-800';
              const textClass = isActive ? 'text-indigo-400' : 'text-slate-400';

              return `
                      <div onclick="setVisual('${guide.key}')" class="p-3 rounded-xl transition-all cursor-pointer border ${borderClass}">
                          <div class="text-xs font-bold uppercase tracking-wider mb-1 ${textClass}">${guide.label}</div>
                          <p class="text-sm text-slate-300 leading-snug">${guide.text}</p>
                      </div>
                  `;
            })
            .join('');

          // SVGS
          let svgContent = '';
          const opacity = (key) => (state.activeVisual === key ? 'opacity-100' : 'opacity-20');

          if (state.activeTab === 'jackets' || state.activeTab === 'shirts') {
            const isJacket = state.activeTab === 'jackets';
            svgContent = `
                  <svg viewBox="0 0 200 200" class="w-full h-full drop-shadow-2xl">
                      <path d="M 60 40 L 40 70 L 40 160 L 160 160 L 160 70 L 140 40 L 120 50 L 80 50 Z" fill="#334155" stroke="#475569" stroke-width="2"/>
                      ${
                        isJacket
                          ? `<path d="M 40 70 L 10 130 L 25 140 L 40 110" fill="#334155" stroke="#475569" stroke-width="2"/><path d="M 160 70 L 190 130 L 175 140 L 160 110" fill="#334155" stroke="#475569" stroke-width="2"/>`
                          : `<path d="M 40 70 L 10 90 L 20 120 L 40 110" fill="#334155" stroke="#475569" stroke-width="2"/><path d="M 160 70 L 190 90 L 180 120 L 160 110" fill="#334155" stroke="#475569" stroke-width="2"/>`
                      }
                      <path d="M 100 50 L 100 160" stroke="#1e293b" stroke-width="2" stroke-dasharray="${isJacket ? '4 2' : '0'}"/>
                      
                      <g class="transition-opacity duration-500 ${opacity('chest')}">
                          <line x1="42" y1="100" x2="158" y2="100" stroke="#ef4444" stroke-width="3" />
                          <rect x="90" y="90" width="20" height="15" rx="2" fill="#ef4444" />
                          <text x="100" y="100" text-anchor="middle" fill="white" font-size="8" font-weight="bold" dy="3">Ch</text>
                      </g>
                      ${
                        !isJacket
                          ? `
                      <g class="transition-opacity duration-500 ${opacity('neck')}">
                          <ellipse cx="100" cy="50" rx="25" ry="8" fill="none" stroke="#22c55e" stroke-width="2" />
                          <text x="100" y="45" text-anchor="middle" fill="#22c55e" font-size="8" font-weight="bold">Neck</text>
                      </g>`
                          : ''
                      }
                      ${
                        isJacket
                          ? `
                      <g class="transition-opacity duration-500 ${opacity('length')}">
                          <line x1="120" y1="50" x2="120" y2="160" stroke="#3b82f6" stroke-width="3" />
                          <rect x="110" y="100" width="20" height="15" rx="2" fill="#3b82f6" />
                          <text x="120" y="110" text-anchor="middle" fill="white" font-size="8" font-weight="bold" dy="3">Len</text>
                      </g>`
                          : ''
                      }
                      <g class="transition-opacity duration-500 ${opacity('sleeve')}">
                           <path d="${isJacket ? 'M 140 40 L 190 130' : 'M 140 40 L 190 90'}" stroke="#3b82f6" stroke-width="3" stroke-dasharray="4 2" />
                           <text x="170" y="${isJacket ? '85' : '60'}" text-anchor="middle" fill="#3b82f6" font-size="8" font-weight="bold">Slv</text>
                      </g>
                  </svg>`;
          } else if (state.activeTab === 'pants') {
            svgContent = `
                  <svg viewBox="0 0 200 200" class="w-full h-full drop-shadow-2xl">
                      <path d="M 60 30 L 140 30 L 150 60 L 145 180 L 105 180 L 100 80 L 95 180 L 55 180 L 50 60 Z" fill="#334155" stroke="#475569" stroke-width="2"/>
                      <path d="M 60 30 L 140 30 L 142 45 L 58 45 Z" fill="#1e293b" />
                      <circle cx="100" cy="37" r="3" fill="#94a3b8" />
                      <g class="transition-opacity duration-500 ${opacity('waist')}">
                          <line x1="55" y1="38" x2="145" y2="38" stroke="#ef4444" stroke-width="3" />
                          <rect x="90" y="28" width="20" height="15" rx="2" fill="#ef4444" />
                          <text x="100" y="38" text-anchor="middle" fill="white" font-size="8" font-weight="bold" dy="3">W</text>
                      </g>
                      <g class="transition-opacity duration-500 ${opacity('hips')}">
                          <line x1="52" y1="65" x2="148" y2="65" stroke="#3b82f6" stroke-width="3" stroke-dasharray="4 2"/>
                          <rect x="90" y="58" width="20" height="15" rx="2" fill="#3b82f6" />
                          <text x="100" y="68" text-anchor="middle" fill="white" font-size="8" font-weight="bold" dy="3">H</text>
                      </g>
                      <g class="transition-opacity duration-500 ${opacity('inseam')}">
                          <line x1="102" y1="80" x2="107" y2="180" stroke="#22c55e" stroke-width="3" stroke-dasharray="3 1" />
                          <rect x="105" y="120" width="24" height="15" rx="2" fill="#22c55e" />
                          <text x="117" y="130" text-anchor="middle" fill="white" font-size="8" font-weight="bold" dy="3">Ins</text>
                      </g>
                  </svg>`;
          } else if (state.activeTab === 'belts') {
            svgContent = `
                  <svg viewBox="0 0 200 80" class="w-full h-full drop-shadow-2xl">
                      <rect x="20" y="25" width="25" height="30" rx="3" fill="#94a3b8" stroke="#475569" stroke-width="2" />
                      <line x1="35" y1="25" x2="35" y2="55" stroke="#475569" stroke-width="2" />
                      <line x1="38" y1="40" x2="50" y2="40" stroke="#cbd5e1" stroke-width="3" />
                      <path d="M 45 30 L 170 30 Q 180 30 180 40 Q 180 50 170 50 L 45 50" fill="#334155" stroke="#475569" stroke-width="2"/>
                      <circle cx="140" cy="40" r="2" fill="#1e293b" /><circle cx="150" cy="40" r="2" fill="#1e293b" /><circle cx="160" cy="40" r="2" fill="#1e293b" />
                      <g class="transition-opacity duration-500 ${opacity('length')}">
                          <line x1="35" y1="65" x2="150" y2="65" stroke="#ef4444" stroke-width="3" />
                          <line x1="35" y1="58" x2="35" y2="72" stroke="#ef4444" stroke-width="2" />
                          <rect x="80" y="55" width="30" height="20" rx="4" fill="#ef4444" />
                          <text x="95" y="68" text-anchor="middle" fill="white" font-size="10" font-weight="bold" dy="0">Len</text>
                      </g>
                      <g class="transition-opacity duration-500 ${opacity('waist')}">
                          <circle cx="150" cy="40" r="4" fill="none" stroke="#3b82f6" stroke-width="2" />
                          <text x="150" y="25" text-anchor="middle" fill="#3b82f6" font-size="8" font-weight="bold">Center</text>
                      </g>
                  </svg>`;
          } else if (state.activeTab === 'shoes') {
            svgContent = `
                  <svg viewBox="0 0 200 150" class="w-full h-full drop-shadow-2xl">
                      <defs><linearGradient id="shoeGradient" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#334155" /><stop offset="100%" stop-color="#1e293b" /></linearGradient></defs>
                      <ellipse cx="100" cy="125" rx="85" ry="8" fill="#000" opacity="0.3" />
                      <path d="M 25 95 Q 25 115 45 115 L 160 115 Q 180 115 180 95 L 180 90 L 25 90 Z" fill="#e2e8f0" stroke="#94a3b8" stroke-width="2"/>
                      <path d="M 180 95 L 25 95" stroke="#cbd5e1" stroke-width="2" />
                      <path d="M 30 90 Q 30 65 50 55 L 90 40 Q 110 30 130 45 L 135 55 L 165 55 Q 180 60 180 90 L 30 90 Z" fill="url(#shoeGradient)" stroke="#475569" stroke-width="2"/>
                      <g class="transition-opacity duration-500 ${opacity('cm') ? 'opacity-100' : 'opacity-80'}">
                          <line x1="20" y1="135" x2="185" y2="135" stroke="#ef4444" stroke-width="3" />
                          <rect x="85" y="125" width="35" height="20" rx="4" fill="#ef4444" />
                          <text x="102" y="138" text-anchor="middle" fill="white" font-size="10" font-weight="bold" dy="3">Length</text>
                      </g>
                  </svg>`;
          }

          els.svgContainer.innerHTML = svgContent;
        }

        function renderFooter() {
          els.footerTip.innerText =
            state.activeTab === 'shoes'
              ? 'Measure feet in the afternoon as they swell slightly during the day.'
              : 'If between sizes, always size up for comfort.';
        }

        // --- ACTIONS ---

        window.changeTab = (tab) => {
          state.activeTab = tab;
          state.recommendedID = null;
          state.activeVisual = null;
          state.dropdownOpen = false;
          els.categoryMenu.classList.add('hidden');
          els.chevron.classList.remove('rotate-180');
          els.calcResult.classList.add('hidden');
          els.calcInput.value = '';

          init(); // Re-render everything
        };

        window.setVisual = (key) => {
          state.activeVisual = key;
          renderVisual();
        };

        // --- EVENT LISTENERS ---

        els.categoryTrigger.addEventListener('click', () => {
          state.dropdownOpen = !state.dropdownOpen;
          if (state.dropdownOpen) {
            els.categoryMenu.classList.remove('hidden');
            els.chevron.classList.add('rotate-180');
          } else {
            els.categoryMenu.classList.add('hidden');
            els.chevron.classList.remove('rotate-180');
          }
        });

        els.genderToggles.addEventListener('click', (e) => {
          if (e.target.tagName === 'BUTTON') {
            state.category = e.target.dataset.cat;
            state.recommendedID = null; // reset rec
            renderGender();
            renderTable();
          }
        });

        els.unitToggle.addEventListener('click', () => {
          state.unit = state.unit === 'cm' ? 'in' : 'cm';
          renderUnit();
          renderTable();
        });

        els.calcBtn.addEventListener('click', () => {
          const val = parseFloat(els.calcInput.value);
          if (isNaN(val)) return;

          const info = DATA[state.activeTab];
          const rangeData = info.ranges[state.category] || info.ranges.men;

          // Logic
          let found = null;

          if (state.activeTab === 'shoes') {
            found = rangeData.find((r) => r.us == val); // loose equality for strings
            if (found) {
              state.recommendedID = found.us;
              els.resSize.innerText = `EU ${found.eu}`;
              els.resMsg.innerText = `US ${found.us} equals EU ${found.eu}`;
            } else {
              state.recommendedID = null;
              els.resSize.innerText = '?';
              els.resMsg.innerText = 'Size not in chart.';
            }
          } else {
            // Determine keys
            let key = '';
            if (state.activeTab === 'jackets' || state.activeTab === 'shirts')
              key = state.unit === 'cm' ? 'chest_cm' : 'chest_in';
            else key = state.unit === 'cm' ? 'waist_cm' : 'waist_in';

            found = rangeData.find((size) => {
              const range = size[key].split('-').map(Number);
              if (range.length === 2) return val >= range[0] && val <= range[1];
              return val <= range[0];
            });

            if (found) {
              state.recommendedID = found.label;
              els.resSize.innerText = found.label.split(' ')[0];
              els.resMsg.innerText = 'Perfect match found.';
            } else {
              // Check bounds
              const first = parseFloat(rangeData[0][key].split('-')[0]);
              if (val < first) {
                state.recommendedID = rangeData[0].label;
                els.resSize.innerText = 'XS-';
                els.resMsg.innerText = 'Smaller than standard sizing.';
              } else {
                state.recommendedID = rangeData[rangeData.length - 1].label;
                els.resSize.innerText = 'XXL+';
                els.resMsg.innerText = 'Larger than standard sizing.';
              }
            }
          }

          els.calcResult.classList.remove('hidden');
          renderTable(); // To update highlights
        });

        // Run Init
        init();
      </script>
    {% endif %}
  </body>
</html>
