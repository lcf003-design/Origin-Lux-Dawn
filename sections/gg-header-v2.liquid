{% schema %}
{
  "name": "Origin GG Header V2",
  "class": "section-gg-header-v2",
  "settings": [
    {
      "type": "header",
      "content": "üõ°Ô∏è The Shield (Huge Logo)"
    },
    {
      "type": "image_picker",
      "id": "shield_logo_desktop",
      "label": "Desktop Shield Logo",
      "info": "The massive logo shown initially."
    },
    {
      "type": "image_picker",
      "id": "shield_logo_mobile",
      "label": "Mobile Shield Logo"
    },
    {
      "type": "range",
      "id": "shield_width_desktop",
      "min": 20,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Desktop Width",
      "default": 60
    },
    {
      "type": "range",
      "id": "shield_width_mobile",
      "min": 20,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Mobile Width",
      "default": 80
    },
    {
      "type": "range",
      "id": "shield_position_y_desktop",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": "Desktop Vertical Position (Y)",
      "default": 40
    },
    {
      "type": "range",
      "id": "shield_position_y_mobile",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": "Mobile Vertical Position (Y)",
      "default": 40
    },
    {
      "type": "header",
      "content": "‚ú® Sticky Header"
    },
    {
      "type": "image_picker",
      "id": "sticky_logo",
      "label": "Sticky Bar Logo",
      "info": "Appears when scrolled."
    },
    {
      "type": "range",
      "id": "sticky_logo_height",
      "min": 20,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Logo Height",
      "default": 32
    },
    {
      "type": "checkbox",
      "id": "enable_glass",
      "label": "Enable Glassmorphism",
      "default": true
    },
    {
      "type": "range",
      "id": "glass_blur",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Blur Intensity",
      "default": 20
    },
    {
      "type": "color",
      "id": "sticky_bg_color",
      "label": "Scrolled Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "sticky_text_color",
      "label": "Scrolled Text Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "initial_text_color",
      "label": "Initial Icon Color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Main Menu",
      "default": "main-menu"
    }
  ],
  "presets": [
    {
      "name": "Origin GG Header V2"
    }
  ]
}
{% endschema %}

<script src="{{ 'predictive-search.js' | asset_url }}" defer="defer"></script>

{% style %}
  /* --- VARIABLES --- */
  #shopify-section-{{ section.id }} {
    --shield-y: {{ section.settings.shield_position_y_desktop }}%;
    --shield-y-mobile: {{ section.settings.shield_position_y_mobile }}%;
    --shield-w-desktop: {{ section.settings.shield_width_desktop }}%;
    --shield-w-mobile: {{ section.settings.shield_width_mobile }}%;
    --sticky-logo-h: {{ section.settings.sticky_logo_height }}px;
    --glass-blur: {{ section.settings.glass_blur }}px;
    --sticky-bg: {{ section.settings.sticky_bg_color }};
    --sticky-text: {{ section.settings.sticky_text_color }};
    --initial-text: {{ section.settings.initial_text_color }};
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 200; /* FIX: Must be higher than Hero (150) */
    pointer-events: none; /* CRITICAL: NUKE PROOF INTERACTION */
  }

  /* --- THE SHIELD (HUGE LOGO) --- */
  .gg-shield-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    pointer-events: none;
    z-index: 1;
    overflow: hidden;
    clip-path: inset(0 0 0 0); /* Performance hack */
  }

  .gg-shield-inner {
    position: absolute;
    top: var(--shield-y);
    left: 50%;
    transform: translate(-50%, -50%);
    width: var(--shield-w-desktop);
    max-width: 1200px;
    transition: opacity 0.4s ease, transform 0.4s ease;
    will-change: opacity, transform;
  }

  .gg-shield-img {
    width: 100%;
    height: auto;
    display: block;
  }

  /* Hide shield on scroll */
  #shopify-section-{{ section.id }}.scrolled .gg-shield-inner {
    opacity: 0;
    transform: translate(-50%, -60%);
    pointer-events: none;
  }

  /* --- STICKY BAR --- */
  .gg-sticky-bar {
    position: relative;
    width: 100%;
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    padding: 15px 40px;
    transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
    z-index: 50;
    /* Initial State: Transparent */
    background: transparent;
    color: var(--initial-text);
  }

  /* Scrolled State */
  .gg-sticky-bar.is-scrolled {
    padding: 10px 30px;
    color: var(--sticky-text);
    background: {% if section.settings.enable_glass %}rgba(255, 255, 255, 0.85){% else %}var(--sticky-bg){% endif %};
    {% if section.settings.enable_glass %}
      backdrop-filter: blur(var(--glass-blur));
      -webkit-backdrop-filter: blur(var(--glass-blur));
    {% endif %}
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.05);
    pointer-events: auto; /* Bar becomes clickable only when scrolled/solid */
  }

  /* FIX: Ensure sticky logo is visible when scrolled */
  .gg-sticky-bar.is-scrolled .gg-sticky-logo {
    opacity: 1 !important;
    transform: translateY(0) !important;
    pointer-events: auto;
  }

  /* --- INTERACTIVE ELEMENTS (Always Clickable) --- */
  .gg-icon-btn,
  .gg-logo-link,
  .gg-hamburger {
    pointer-events: auto; /* EXEMPT FROM NUKE */
    cursor: pointer;
    background: none;
    border: none;
    padding: 0;
    color: inherit;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity 0.3s;
  }
  .gg-icon-btn:hover, .gg-hamburger:hover { opacity: 0.7; }

  /* Logo in Sticky Bar */
  .gg-sticky-logo {
    height: var(--sticky-logo-h);
    width: auto;
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.4s ease;
    pointer-events: none; /* Hidden strictly */
  }

  .gg-sticky-bar.is-scrolled .gg-sticky-logo {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
  }

  .gg-header-right {
    display: flex;
    justify-content: flex-end;
    gap: 20px;
  }

  /* --- MOBILE --- */
  @media (max-width: 768px) {
    #shopify-section-{{ section.id }} {
      --shield-w: var(--shield-w-mobile);
      --shield-y: var(--shield-y-mobile);
    }
    .gg-shield-inner { width: var(--shield-w-mobile); }
    .gg-sticky-bar { padding: 12px 20px; }
    .gg-sticky-bar.is-scrolled { padding: 10px 20px; }
    .gg-header-right { gap: 15px; }
  }

  /* --- DESKTOP VS MOBILE SHOW/HIDE (Vanilla CSS Fix) --- */
  .gg-shield-img-desktop { display: none; }
  .gg-shield-img-mobile { display: block; }

  @media (min-width: 769px) {
    .gg-shield-img-desktop { display: block; }
    .gg-shield-img-mobile { display: none; }
  }

  /* --- MENU DRAWER (Premium) --- */
  .gg-menu-drawer {
    background: linear-gradient(145deg, rgba(15,15,15,0.98) 0%, rgba(30,30,30,0.99) 100%);
    box-shadow: 10px 0 30px rgba(0,0,0,0.5);
    width: 380px;
    max-width: 90vw;
    height: 100%;
    padding: 40px 0;
    transform: translateX(-102%);
    transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1);
    display: flex;
    flex-direction: column;
    color: #ffffff;
    overflow-y: auto;
    font-family: var(--font-menu, sans-serif);
    z-index: 201;
    position: fixed;
    top: 0;
    left: 0;
  }

  .gg-drawer-overlay.active .gg-menu-drawer {
    transform: translateX(0);
  }

  .gg-menu-list {
    list-style: none;
    padding: 0 30px;
    margin: 40px 0 0 0;
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .gg-menu-link-wrapper {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    cursor: pointer;
    transition: transform 0.3s ease;
    border-bottom: 1px solid rgba(255,255,255,0.08);
  }
  .gg-menu-link-wrapper:hover { transform: translateX(10px); }

  .gg-menu-link {
    text-decoration: none;
    color: #ffffff;
    font-size: 20px;
    font-weight: 400;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    flex-grow: 1;
  }

  .gg-accordion-icon {
    width: 14px;
    height: 14px;
    transition: transform 0.3s ease;
    opacity: 0.7;
  }

  /* Level 2 Submenu */
  .gg-submenu {
    display: none;
    list-style: none;
    padding: 0;
    margin: 0;
    background: rgba(255,255,255,0.03);
    border-radius: 4px;
  }
  .gg-submenu.is-open {
    display: block;
    animation: ggFadeIn 0.3s ease;
  }
  @keyframes ggFadeIn { from { opacity: 0; } to { opacity: 1; } }

  .gg-submenu li { padding-left: 20px; border-bottom: 1px solid rgba(255,255,255,0.05); }
  .gg-submenu li a {
    font-size: 16px;
    opacity: 0.8;
    text-transform: none;
    font-weight: 300;
    display: block;
    padding: 10px 0;
    text-decoration: none;
    color: #fff;
  }

  /* Level 3 Submenu (The Pop) */
  .gg-submenu .gg-submenu {
    background: transparent;
    margin: 5px 0 10px 10px;
    border-left: 1px solid rgba(255,255,255,0.15);
    padding-left: 0;
  }
  .gg-submenu .gg-submenu li { border: none; padding: 0; }
  .gg-submenu .gg-submenu li a {
    font-size: 15px;
    opacity: 0.6;
    padding: 8px 0 8px 15px;
    position: relative;
    transition: all 0.3s ease;
  }
  /* The Dot */
  .gg-submenu .gg-submenu li a::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    width: 4px;
    height: 4px;
    background-color: currentColor;
    border-radius: 50%;
    transform: translateY(-50%);
    opacity: 0.4;
    transition: opacity 0.3s ease;
  }
  .gg-submenu .gg-submenu li a:hover {
    opacity: 1;
    transform: translateX(5px);
  }
  .gg-submenu .gg-submenu li a:hover::before { opacity: 1; }

  /* --- SEARCH OVERLAY --- */
  .gg-search-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(10, 10, 10, 0.9);
    backdrop-filter: blur(25px);
    z-index: 250;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
  }
  .gg-search-overlay.active {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
  }

  .gg-search-container {
    width: 90%;
    max-width: 800px;
    position: relative;
    text-align: center;
    color: #fff;
  }

  .gg-search-input {
    width: 100%;
    background: transparent;
    border: none;
    border-bottom: 2px solid #fff;
    color: #fff;
    font-size: clamp(24px, 4vw, 48px);
    padding: 15px 0;
    outline: none;
    text-align: center;
    font-family: var(--font-huge-logo, serif);
    text-transform: uppercase;
  }
  .gg-search-input::placeholder { color: rgba(255,255,255,0.5); }

  .gg-search-close {
    position: absolute;
    top: 30px;
    right: 30px;
    background: none;
    border: none;
    color: #fff;
    cursor: pointer;
    z-index: 260;
  }

  /* Custom Predictive Search Styles */
  .predictive-search {
    margin-top: 20px;
    text-align: left;
    max-height: 60vh;
    overflow-y: auto;
  }
  .predictive-search-results-list {
    list-style: none;
    padding: 0;
  }
  .predictive-search-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 10px 0;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    color: #fff;
    text-decoration: none;
  }
  .predictive-search-item:hover { background: rgba(255,255,255,0.05); }
  .predictive-search-item img { width: 50px; height: 50px; object-fit: cover; }
  .predictive-search-item__content { display: flex; flex-direction: column; }
  .predictive-search-item__title { font-weight: bold; }
{% endstyle %}

<!-- THE SHIELD -->
<div class="gg-shield-wrapper" aria-hidden="true">
  <div class="gg-shield-inner">
    {% if section.settings.shield_logo_desktop %}
      <img
        src="{{ section.settings.shield_logo_desktop | image_url: width: 1400 }}"
        class="gg-shield-img gg-shield-img-desktop"
        alt="Shield Logo"
        width="{{ section.settings.shield_logo_desktop.width }}"
        height="{{ section.settings.shield_logo_desktop.height }}"
      >
    {% endif %}
    {% if section.settings.shield_logo_mobile %}
      <img
        src="{{ section.settings.shield_logo_mobile | image_url: width: 800 }}"
        class="gg-shield-img gg-shield-img-mobile"
        alt="Shield Logo"
        width="{{ section.settings.shield_logo_mobile.width }}"
        height="{{ section.settings.shield_logo_mobile.height }}"
      >
    {% endif %}
  </div>
</div>

<!-- STICKY BAR -->
<header class="gg-sticky-bar" id="gg-sticky-bar">
  <!-- Left: Menu -->
  <div class="gg-header-left">
    <button class="gg-hamburger" onclick="toggleGGDrawer()" aria-label="Menu">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
  </div>

  <!-- Center: Sticky Logo -->
  <div class="gg-header-center" style="justify-self: center;">
    <a href="{{ routes.root_url }}" class="gg-logo-link">
      {% if section.settings.sticky_logo %}
        <img
          src="{{ section.settings.sticky_logo | image_url: width: 400 }}"
          class="gg-sticky-logo"
          alt="{{ shop.name }}"
          width="{{ section.settings.sticky_logo.width }}"
          height="{{ section.settings.sticky_logo.height }}"
        >
      {% else %}
        <span class="gg-sticky-logo" style="font-weight:bold; text-transform:uppercase;">{{ shop.name }}</span>
      {% endif %}
    </a>
  </div>

  <!-- Right: Actions -->
  <div class="gg-header-right">
    <button class="gg-icon-btn" aria-label="Search" onclick="toggleGGSearch()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
      </svg>
    </button>

    {% if shop.customer_accounts_enabled %}
      <a href="{{ routes.account_url }}" class="gg-icon-btn" aria-label="Account">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
        </svg>
      </a>
    {% endif %}

    <a href="{{ routes.cart_url }}" class="gg-icon-btn" aria-label="Cart">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
        <line x1="3" y1="6" x2="21" y2="6"></line>
      </svg>
    </a>
  </div>
</header>

<!-- MENU DRAWER -->
<div class="gg-drawer-overlay" id="gg-drawer-overlay" onclick="toggleGGDrawer()">
  <div class="gg-menu-drawer" onclick="event.stopPropagation()">
    <button
      class="gg-icon-btn"
      onclick="toggleGGDrawer()"
      style="align-self: flex-end; margin-right: 20px; margin-bottom: 20px;"
    >
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>

    <nav>
      <ul class="gg-menu-list">
        {% for link in linklists[section.settings.menu].links %}
          <li class="gg-menu-item">
            {% if link.links != blank %}
              <div class="gg-menu-link-wrapper accordion-trigger">
                <a href="{{ link.url }}" class="gg-menu-link">{{ link.title }}</a>
                <svg class="gg-accordion-icon" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M7 1v12M1 7h12"/>
                </svg>
              </div>
              <!-- LEVEL 2 -->
              <ul class="gg-submenu">
                {% for child_link in link.links %}
                  <li>
                    {% if child_link.links != blank %}
                      <div class="gg-menu-link-wrapper accordion-trigger" style="border:none; padding:5px 0;">
                        <a href="{{ child_link.url }}" class="gg-menu-link" style="font-size:18px;">
                          {{- child_link.title -}}
                        </a>
                        <svg
                          class="gg-accordion-icon"
                          viewBox="0 0 14 14"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                        >
                          <path d="M7 1v12M1 7h12"/>
                        </svg>
                      </div>
                      <!-- LEVEL 3 -->
                      <ul class="gg-submenu">
                        {% for grandchild_link in child_link.links %}
                          <li>
                            <a href="{{ grandchild_link.url }}">{{ grandchild_link.title }}</a>
                          </li>
                        {% endfor %}
                      </ul>
                    {% else %}
                      <a href="{{ child_link.url }}">{{ child_link.title }}</a>
                    {% endif %}
                  </li>
                {% endfor %}
              </ul>
            {% else %}
              <!-- LEVEL 1 SIMPLE -->
              <div class="gg-menu-link-wrapper">
                <a href="{{ link.url }}" class="gg-menu-link">{{ link.title }}</a>
              </div>
            {% endif %}
          </li>
        {% endfor %}

        {% if shop.customer_accounts_enabled %}
          <li style="margin-top: 30px; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 20px;">
            <a href="{{ routes.account_url }}" class="gg-menu-link" style="font-size: 18px;">My Account</a>
          </li>
        {% endif %}
      </ul>
    </nav>
  </div>
</div>

<!-- SEARCH OVERLAY -->
<div class="gg-search-overlay" id="gg-search-overlay">
  <button class="gg-search-close" onclick="toggleGGSearch()">
    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <line x1="18" y1="6" x2="6" y2="18"></line>
      <line x1="6" y1="6" x2="18" y2="18"></line>
    </svg>
  </button>
  <div class="gg-search-container" onclick="event.stopPropagation()">
    <predictive-search data-loading-text="{{ 'accessibility.loading' | t }}">
      <form action="{{ routes.search_url }}" method="get" role="search">
        <input
          id="gg-search-input"
          class="gg-search-input"
          type="search"
          name="q"
          value="{{ search.terms | escape }}"
          placeholder="SEARCH..."
          role="combobox"
          aria-expanded="false"
          aria-owns="predictive-search-results"
          aria-controls="predictive-search-results"
          aria-haspopup="listbox"
          aria-autocomplete="list"
        >
        <input type="hidden" name="type" value="product">
        <div id="predictive-search" tabindex="-1" data-predictive-search></div>
        <span class="predictive-search-status visually-hidden" role="status" aria-hidden="true"></span>
      </form>
    </predictive-search>
  </div>
</div>

<script>
  // Scroll Logic
  const ggHeaderObserver = () => {
    const header = document.getElementById('shopify-section-{{ section.id }}');
    const stickyBar = document.getElementById('gg-sticky-bar');

    window.addEventListener('scroll', () => {
      if (window.scrollY > 50) {
        stickyBar.classList.add('is-scrolled');
        header.classList.add('scrolled');
      } else {
        stickyBar.classList.remove('is-scrolled');
        header.classList.remove('scrolled');
      }
    });

    // Submenu Accordion Logic (Level 2 & 3)
    document.querySelectorAll('.accordion-trigger').forEach((trigger) => {
      trigger.addEventListener('click', function (e) {
        e.preventDefault();
        e.stopPropagation(); // Stop bubble

        const submenu = this.nextElementSibling;
        const icon = this.querySelector('.gg-accordion-icon');

        if (submenu) {
          submenu.classList.toggle('is-open');
          // Rotate Icon
          if (icon) {
            if (submenu.classList.contains('is-open')) {
              icon.style.transform = 'rotate(45deg)';
            } else {
              icon.style.transform = 'rotate(0deg)';
            }
          }
        }
      });
    });
  };

  // Drawer Toggle
  window.toggleGGDrawer = () => {
    const overlay = document.getElementById('gg-drawer-overlay');
    overlay.classList.toggle('active');
    document.body.style.overflow = overlay.classList.contains('active') ? 'hidden' : '';
  };

  // Search Toggle
  window.toggleGGSearch = () => {
    const overlay = document.getElementById('gg-search-overlay');
    const input = document.getElementById('gg-search-input');
    overlay.classList.toggle('active');

    if (overlay.classList.contains('active')) {
      document.body.style.overflow = 'hidden';
      setTimeout(() => input.focus(), 100);
    } else {
      document.body.style.overflow = '';
    }
  };

  // Close on Escape
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      document.getElementById('gg-drawer-overlay').classList.remove('active');
      document.getElementById('gg-search-overlay').classList.remove('active');
      document.body.style.overflow = '';
    }
  });

  document.addEventListener('DOMContentLoaded', ggHeaderObserver);
  if (Shopify.designMode) {
    document.addEventListener('shopify:section:load', ggHeaderObserver);
  }
</script>
