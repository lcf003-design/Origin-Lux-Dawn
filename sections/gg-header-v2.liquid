{% schema %}
{
  "name": "Origin GG Header V2",
  "class": "section-gg-header-v2",
  "settings": [
    {
      "type": "header",
      "content": "üõ°Ô∏è The Shield (Huge Logo)"
    },
    {
      "type": "image_picker",
      "id": "shield_logo_desktop",
      "label": "Desktop Shield Logo",
      "info": "The massive logo shown initially."
    },
    {
      "type": "image_picker",
      "id": "shield_logo_mobile",
      "label": "Mobile Shield Logo"
    },
    {
      "type": "range",
      "id": "shield_width_desktop",
      "min": 20,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Desktop Width",
      "default": 60
    },
    {
      "type": "range",
      "id": "shield_width_mobile",
      "min": 20,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Mobile Width",
      "default": 80
    },
    {
      "type": "range",
      "id": "shield_position_y",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": "Vertical Position (Y)",
      "default": 40
    },
    {
      "type": "header",
      "content": "‚ú® Sticky Header"
    },
    {
      "type": "image_picker",
      "id": "sticky_logo",
      "label": "Sticky Bar Logo",
      "info": "Appears when scrolled."
    },
    {
      "type": "range",
      "id": "sticky_logo_height",
      "min": 20,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Logo Height",
      "default": 32
    },
    {
      "type": "checkbox",
      "id": "enable_glass",
      "label": "Enable Glassmorphism",
      "default": true
    },
    {
      "type": "range",
      "id": "glass_blur",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Blur Intensity",
      "default": 20
    },
    {
      "type": "color",
      "id": "sticky_bg_color",
      "label": "Scrolled Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "sticky_text_color",
      "label": "Scrolled Text Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "initial_text_color",
      "label": "Initial Icon Color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Main Menu",
      "default": "main-menu"
    }
  ],
  "presets": [
    {
      "name": "Origin GG Header V2"
    }
  ]
}
{% endschema %}

{% style %}
  /* --- VARIABLES --- */
  #shopify-section-{{ section.id }} {
    --shield-y: {{ section.settings.shield_position_y }}%;
    --shield-w-desktop: {{ section.settings.shield_width_desktop }}%;
    --shield-w-mobile: {{ section.settings.shield_width_mobile }}%;
    --sticky-logo-h: {{ section.settings.sticky_logo_height }}px;
    --glass-blur: {{ section.settings.glass_blur }}px;
    --sticky-bg: {{ section.settings.sticky_bg_color }};
    --sticky-text: {{ section.settings.sticky_text_color }};
    --initial-text: {{ section.settings.initial_text_color }};
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 100;
    pointer-events: none; /* CRITICAL: NUKE PROOF INTERACTION */
  }

  /* --- THE SHIELD (HUGE LOGO) --- */
  .gg-shield-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    pointer-events: none;
    z-index: 1;
    overflow: hidden;
    clip-path: inset(0 0 0 0); /* Performance hack */
  }

  .gg-shield-inner {
    position: absolute;
    top: var(--shield-y);
    left: 50%;
    transform: translate(-50%, -50%);
    width: var(--shield-w-desktop);
    max-width: 1200px;
    transition: opacity 0.4s ease, transform 0.4s ease;
    will-change: opacity, transform;
  }

  .gg-shield-img {
    width: 100%;
    height: auto;
    display: block;
  }

  /* Hide shield on scroll */
  .scrolled .gg-shield-inner {
    opacity: 0;
    transform: translate(-50%, -60%);
  }

  /* --- STICKY BAR --- */
  .gg-sticky-bar {
    position: relative;
    width: 100%;
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    padding: 15px 40px;
    transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
    z-index: 50;
    /* Initial State: Transparent */
    background: transparent;
    color: var(--initial-text);
  }

  /* Scrolled State */
  .gg-sticky-bar.is-scrolled {
    padding: 10px 30px;
    color: var(--sticky-text);
    background: {% if section.settings.enable_glass %}rgba(255, 255, 255, 0.85){% else %}var(--sticky-bg){% endif %};
    {% if section.settings.enable_glass %}
      backdrop-filter: blur(var(--glass-blur));
      -webkit-backdrop-filter: blur(var(--glass-blur));
    {% endif %}
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.05);
    pointer-events: auto; /* Bar becomes clickable only when scrolled/solid */
  }

  /* --- INTERACTIVE ELEMENTS (Always Clickable) --- */
  .gg-icon-btn,
  .gg-logo-link,
  .gg-hamburger {
    pointer-events: auto; /* EXEMPT FROM NUKE */
    cursor: pointer;
    background: none;
    border: none;
    padding: 0;
    color: inherit;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity 0.3s;
  }
  .gg-icon-btn:hover, .gg-hamburger:hover { opacity: 0.7; }

  /* Logo in Sticky Bar */
  .gg-sticky-logo {
    height: var(--sticky-logo-h);
    width: auto;
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.4s ease;
    pointer-events: none; /* Hidden strictly */
  }

  .gg-sticky-bar.is-scrolled .gg-sticky-logo {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
  }

  .gg-header-right {
    display: flex;
    justify-content: flex-end;
    gap: 20px;
  }

  /* --- MOBILE --- */
  @media (max-width: 768px) {
    #shopify-section-{{ section.id }} {
      --shield-w: var(--shield-w-mobile);
    }
    .gg-shield-inner { width: var(--shield-w-mobile); }
    .gg-sticky-bar { padding: 12px 20px; }
    .gg-sticky-bar.is-scrolled { padding: 10px 20px; }
    .gg-header-right { gap: 15px; }
  }

  /* --- DRAWER (Simplified for V2 Launch) --- */
  .gg-drawer-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    z-index: 200;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
    backdrop-filter: blur(5px);
  }
  .gg-drawer-overlay.active {
    opacity: 1;
    pointer-events: auto;
  }

  .gg-drawer {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 300px;
    background: #111;
    color: #fff;
    transform: translateX(-100%);
    transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);
    padding: 40px 30px;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  .gg-drawer-overlay.active .gg-drawer {
    transform: translateX(0);
  }

  .gg-drawer-link {
    color: #fff;
    text-decoration: none;
    font-size: 1.2rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    padding-bottom: 15px;
  }
{% endstyle %}

<!-- THE SHIELD -->
<div class="gg-shield-wrapper" aria-hidden="true">
  <div class="gg-shield-inner">
    {% if section.settings.shield_logo_desktop %}
      <img
        src="{{ section.settings.shield_logo_desktop | image_url: width: 1400 }}"
        class="gg-shield-img hidden md:block"
        alt="Shield Logo"
        width="{{ section.settings.shield_logo_desktop.width }}"
        height="{{ section.settings.shield_logo_desktop.height }}"
      >
    {% endif %}
    {% if section.settings.shield_logo_mobile %}
      <img
        src="{{ section.settings.shield_logo_mobile | image_url: width: 800 }}"
        class="gg-shield-img block md:hidden"
        alt="Shield Logo"
        width="{{ section.settings.shield_logo_mobile.width }}"
        height="{{ section.settings.shield_logo_mobile.height }}"
      >
    {% endif %}
  </div>
</div>

<!-- STICKY BAR -->
<header class="gg-sticky-bar" id="gg-sticky-bar">
  <!-- Left: Menu -->
  <div class="gg-header-left">
    <button class="gg-hamburger" onclick="toggleGGDrawer()" aria-label="Menu">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
  </div>

  <!-- Center: Sticky Logo -->
  <div class="gg-header-center" style="justify-self: center;">
    <a href="{{ routes.root_url }}" class="gg-logo-link">
      {% if section.settings.sticky_logo %}
        <img
          src="{{ section.settings.sticky_logo | image_url: width: 400 }}"
          class="gg-sticky-logo"
          alt="{{ shop.name }}"
          width="{{ section.settings.sticky_logo.width }}"
          height="{{ section.settings.sticky_logo.height }}"
        >
      {% else %}
        <span class="gg-sticky-logo" style="font-weight:bold; text-transform:uppercase;">{{ shop.name }}</span>
      {% endif %}
    </a>
  </div>

  <!-- Right: Actions -->
  <div class="gg-header-right">
    <a href="{{ routes.search_url }}" class="gg-icon-btn" aria-label="Search">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
      </svg>
    </a>
    <a href="{{ routes.cart_url }}" class="gg-icon-btn" aria-label="Cart">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
        <line x1="3" y1="6" x2="21" y2="6"></line>
      </svg>
    </a>
  </div>
</header>

<!-- DRAWER -->
<div class="gg-drawer-overlay" id="gg-drawer-overlay" onclick="toggleGGDrawer()">
  <div class="gg-drawer" onclick="event.stopPropagation()">
    <button class="gg-icon-btn" onclick="toggleGGDrawer()" style="align-self: flex-end; margin-bottom: 20px;">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>

    <nav class="flex flex-col gap-4">
      {% for link in linklists[section.settings.menu].links %}
        <a href="{{ link.url }}" class="gg-drawer-link">{{ link.title }}</a>
      {% endfor %}
    </nav>
  </div>
</div>

<script>
  // Scroll Logic
  const ggHeaderObserver = () => {
    const header = document.getElementById('shopify-section-{{ section.id }}');
    const stickyBar = document.getElementById('gg-sticky-bar');

    // Add scroll listener
    window.addEventListener('scroll', () => {
      if (window.scrollY > 50) {
        stickyBar.classList.add('is-scrolled');
        header.classList.add('scrolled'); // For shield fade
      } else {
        stickyBar.classList.remove('is-scrolled');
        header.classList.remove('scrolled');
      }
    });
  };

  // Drawer Logic
  window.toggleGGDrawer = () => {
    const overlay = document.getElementById('gg-drawer-overlay');
    overlay.classList.toggle('active');
    document.body.style.overflow = overlay.classList.contains('active') ? 'hidden' : '';
  };

  document.addEventListener('DOMContentLoaded', ggHeaderObserver);
  if (Shopify.designMode) {
    document.addEventListener('shopify:section:load', ggHeaderObserver);
  }
</script>
