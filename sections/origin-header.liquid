{% schema %}
{
  "name": "Origin Header V4 (Final)",
  "class": "section-origin-header",
  "settings": [
    {
      "type": "header",
      "content": "LOGO"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo (White/Light)",
      "info": "Shown on transparent background"
    },
    {
      "type": "image_picker",
      "id": "logo_dark",
      "label": "Logo (Dark)",
      "info": "Shown on white background (scrolled)"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 450,
      "step": 10,
      "unit": "px",
      "label": "Logo Width",
      "default": 160
    },
    {
      "type": "header",
      "content": "LAYOUT"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 60,
      "step": 2,
      "unit": "px",
      "label": "Top Padding",
      "default": 20,
      "info": "Adjust this to move the logo down/up."
    },
    {
      "type": "range",
      "id": "padding_side",
      "min": 10,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Side Padding",
      "default": 40
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu"
    }
  ],
  "presets": [
    {
      "name": "Origin Header V4 (Final)"
    }
  ]
}
{% endschema %}

<header id="OriginHeader" class="origin-header">
  <div class="header-container">
    <div class="header-left">
      <button
        class="icon-btn menu-trigger"
        onclick="document.getElementById('MobileMenu').classList.add('active')"
        aria-label="Menu"
      >
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
    </div>

    <div class="header-center">
      <a href="{{ routes.root_url }}" class="header-logo">
        {% if section.settings.logo != blank %}
          <img
            src="{{ section.settings.logo | image_url: width: 900 }}"
            class="logo-light"
            width="{{ section.settings.logo_width }}"
            height="{{ section.settings.logo_width | times: 0.75 | round }}"
            alt="{{ shop.name }}"
          >
          {% if section.settings.logo_dark != blank %}
            <img
              src="{{ section.settings.logo_dark | image_url: width: 900 }}"
              class="logo-dark"
              width="{{ section.settings.logo_width }}"
              height="{{ section.settings.logo_width | times: 0.75 | round }}"
              alt="{{ shop.name }}"
            >
          {% else %}
            <img
              src="{{ section.settings.logo | image_url: width: 900 }}"
              class="logo-dark"
              width="{{ section.settings.logo_width }}"
              height="{{ section.settings.logo_width | times: 0.75 | round }}"
              style="filter: invert(1);"
              alt="{{ shop.name }}"
            >
          {% endif %}
        {% else %}
          <span class="logo-text">{{ shop.name }}</span>
        {% endif %}
      </a>
    </div>

    <div class="header-right">
      {% render 'header-search', input_id: 'Search-In-Modal' %}

      <a href="{{ routes.account_url }}" class="icon-btn" aria-label="Account">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
      </a>

      <a href="{{ routes.cart_url }}" class="icon-btn cart-btn" id="cart-icon-bubble" aria-label="Cart">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <path d="M16 10a4 4 0 0 1-8 0"></path>
        </svg>
        {% if cart.item_count > 0 %}
          <span class="cart-count">{{ cart.item_count }}</span>
        {% endif %}
      </a>
    </div>
  </div>
</header>

<div id="MobileMenu" class="mobile-menu-overlay">
  <div class="menu-header">
    <button class="close-btn" onclick="document.getElementById('MobileMenu').classList.remove('active')">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>
  <nav class="menu-links">
    {% for link in linklists[section.settings.menu].links %}
      {% if link.links != blank %}
        <div class="menu-dropdown">
          <button class="menu-item dropdown-trigger" onclick="this.parentElement.classList.toggle('active')">
            {{ link.title }}
            <svg
              class="arrow"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M6 9l6 6 6-6"/>
            </svg>
          </button>
          <div class="submenu-items">
            {% for childlink in link.links %}
              {% if childlink.links != blank %}
                <div class="menu-dropdown sub-dropdown">
                  <button class="submenu-link dropdown-trigger" onclick="this.parentElement.classList.toggle('active')">
                    {{ childlink.title }}
                    <svg
                      class="arrow"
                      width="12"
                      height="12"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M6 9l6 6 6-6"/>
                    </svg>
                  </button>
                  <div class="submenu-items grandchild-items">
                    {% for grandchildlink in childlink.links %}
                      <a href="{{ grandchildlink.url }}" class="submenu-link grandchild-link">
                        {{- grandchildlink.title -}}
                      </a>
                    {% endfor %}
                  </div>
                </div>
              {% else %}
                <a href="{{ childlink.url }}" class="submenu-link">{{ childlink.title }}</a>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      {% else %}
        <a href="{{ link.url }}" class="menu-item">{{ link.title }}</a>
      {% endif %}
    {% endfor %}
  </nav>
</div>

<script>
  (function () {
    const header = document.getElementById('OriginHeader');
    if (!header) return;

    const toggleScrolled = () => {
      header.classList.toggle('scrolled', window.scrollY > 10);
    };

    // Run once on load
    toggleScrolled();
    // And on scroll
    window.addEventListener('scroll', toggleScrolled);
  })();
</script>

<style>
  /* HEADER BASE */
  .origin-header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 100;
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_top }}px;
    padding-left: {{ section.settings.padding_side }}px;
    padding-right: {{ section.settings.padding_side }}px;
    background: transparent !important;
    color: #ffffff;
    box-shadow: none !important;
    transition: padding 0.35s ease, transform 0.35s ease;
  }

  /* SCROLLED STATE (keep padding tighter but no background/shadow/color change) */
  .origin-header.scrolled {
    padding-top: 15px;
    padding-bottom: 15px;
    background: transparent !important;
    box-shadow: none !important;
    color: #ffffff;
  }

  /* ICONS stay white */
  .origin-header .icon-btn,
  .origin-header .menu-trigger {
    color: #ffffff;
  }
  .origin-header .icon-btn svg,
  .origin-header .menu-trigger svg {
    stroke: currentColor;
    transition: stroke 0.35s ease, color 0.35s ease;
  }

  .header-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  /* SECTIONS */
  .header-left,
  .header-right {
    flex: 1;
    display: flex;
    align-items: center;
  }
  .header-right {
    justify-content: flex-end;
    gap: 1.5rem;
  }
  .header-center {
    flex: 2;
    text-align: center;
    display: flex;
    justify-content: center;
  }

  /* ICON BUTTONS */
  .icon-btn {
    background: none;
    border: none;
    color: currentColor;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    transition: opacity 0.3s;
  }
  .icon-btn:hover { opacity: 0.7; }

  /* CART COUNT */
  .cart-btn { position: relative; }
  .cart-count {
    position: absolute;
    top: -5px;
    right: -8px;
    background: #fff;
    color: #000;
    font-size: 10px;
    font-weight: bold;
    width: 16px;
    height: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
  }
  .origin-header.scrolled .cart-count {
    background: #fff;
    color: #000;
  }

  /* LOGO SWAP + SIZE */
  .logo-dark { display: none; }
  .logo-light { display: block; }
  .origin-header.scrolled .logo-light { display: none; }
  .origin-header.scrolled .logo-dark { display: block; }

  /* BIG â†’ SMALL LOGO ANIMATION */
  .header-logo img {
    display: block;
    transform-origin: center center;
    transform: scale(1.2);  /* BIG at top - Senior refinement */
    transition: transform 0.35s ease;
  }
  .origin-header.scrolled .header-logo img {
    transform: scale(0.5);  /* MUCH SMALLER when scrolled */
  }

  .logo-text {
    font-family: var(--font-heading-family);
    font-size: 2rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    text-transform: uppercase;
  }

  /* MOBILE ADJUSTMENTS */
  @media screen and (max-width: 768px) {
    .origin-header {
      padding-left: 20px;
      padding-right: 20px;
      padding-top: 10px !important; /* Senior Specialist Fix */
      padding-bottom: 10px !important;
    }
    .header-right { gap: 1rem; }
  }

  /* MENU DRAWER (50% WIDTH + GLASS + SLIDE) */
  .mobile-menu-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 50%;
    min-width: 300px;
    height: 100vh;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    z-index: 200;
    box-shadow: 5px 0 15px rgba(0,0,0,0.3);
    transform: translateX(-100%);
    transition: transform 0.5s cubic-bezier(0.77, 0, 0.175, 1);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    overflow-y: auto;
  }

  .mobile-menu-overlay.active {
    transform: translateX(0);
  }

  .menu-header {
    position: absolute;
    top: 2rem;
    right: 2rem;
  }
  .close-btn {
    color: #fff;
    background: none;
    border: none;
    cursor: pointer;
  }
  .menu-links {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    text-align: center;
    width: 100%;
    max-width: 400px;
    padding: 2rem;
  }
  .menu-item {
    color: #fff;
    font-size: 2rem;
    font-family: var(--font-heading-family);
    text-decoration: none;
    background: none;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    width: 100%;
  }

  /* SUBMENU STYLES */
  .menu-dropdown {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .menu-dropdown > .submenu-items {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.5s ease;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    width: 100%;
  }

  .menu-dropdown.active > .submenu-items {
    max-height: 1200px;
    margin-top: 1rem;
  }
  .menu-dropdown.active > .dropdown-trigger .arrow {
    transform: rotate(180deg);
  }

  .submenu-link {
    color: #ccc;
    font-size: 1.2rem;
    text-decoration: none;
    transition: color 0.2s;
    background: none;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-family: inherit;
  }
  .submenu-link:hover { color: #fff; }

  .grandchild-link {
    color: #999;
    font-size: 1rem;
  }
  .grandchild-link:hover { color: #fff; }

  .arrow { transition: transform 0.3s; }
</style>
