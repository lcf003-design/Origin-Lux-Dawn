{%- if section.settings.enable_splash -%}
  <script>
    // Immediate check to prevent flash of content if already seen
    if (sessionStorage.getItem('splash_seen')) {
      document.documentElement.classList.add('splash-seen');
    }
  </script>

  <style>
    /* Base state: Hidden if seen */
    html.splash-seen #shopify-section-{{ section.id }} {
      display: none !important;
    }

    #SplashPage-{{ section.id }} {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      /* Background logic: The halves will carry the bg color, 
         but we keep a base color here just in case */
      background-color: transparent; 
      z-index: 2147483647;
      display: block; /* Changed from flex to block to hold absolute children */
      visibility: visible;
      pointer-events: auto;
    }

    /* When hidden/done */
    #SplashPage-{{ section.id }}.hidden {
      display: none;
    }

    /* The two halves */
    .splash-half {
      position: absolute;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: {{ section.settings.bg_color }};
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      transition: transform 1s cubic-bezier(0.6, -0.28, 0.735, 0.045), opacity 1s ease-out;
      will-change: transform, opacity;
    }

    /* Left Half Clip Path & Animation */
    .splash-left {
      left: 0;
      /* Zigzag seam down the middle */
      /* Points: TopLeft, TopMid, Zig1, Zig2, Zig3, Zig4, BotMid, BotLeft */
      clip-path: polygon(
        0% 0%, 
        50% 0%, 
        54% 20%, 
        46% 40%, 
        54% 60%, 
        46% 80%, 
        50% 100%, 
        0% 100%
      );
      z-index: 2;
    }

    /* Right Half Clip Path & Animation */
    .splash-right {
      right: 0;
      /* Complementary Zigzag seam */
      /* Points: TopMid, TopRight, BotRight, BotMid, Zig4, Zig3, Zig2, Zig1 */
      clip-path: polygon(
        50% 0%, 
        100% 0%, 
        100% 100%, 
        50% 100%, 
        46% 80%, 
        54% 60%, 
        46% 40%, 
        54% 20%
      );
      z-index: 2;
    }

    /* Content styling - same as before */
    .splash-content {
      text-align: center;
      max-width: 90%;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 40px;
    }

    .splash-logo {
      max-width: {{ section.settings.logo_width }}px;
      width: 100%;
      height: auto;
      display: block;
      animation: splashPulse 2s infinite ease-in-out;
      transform-origin: center;
    }

    @keyframes splashPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .splash-enter-btn {
      background-color: {{ section.settings.btn_bg }};
      color: {{ section.settings.btn_text_color }};
      border: 3px solid #000000;
      padding: 15px 50px;
      font-size: 1.2rem;
      font-weight: 700;
      text-transform: uppercase;
      cursor: pointer;
      transition: transform 0.2s, background-color 0.2s;
      letter-spacing: 2px;
      pointer-events: auto; /* Ensure clickable */
    }

    .splash-enter-btn:hover {
      transform: scale(1.05);
      background-color: {{ section.settings.btn_bg | color_darken: 5 }};
    }

    /* SPLITTING STATE */
    #SplashPage-{{ section.id }}.splitting {
      pointer-events: none; /* Disable clicks during anim */
    }

    #SplashPage-{{ section.id }}.splitting .splash-left {
      transform: translateX(-100%) rotate(-10deg);
      opacity: 0;
    }

    #SplashPage-{{ section.id }}.splitting .splash-right {
      transform: translateX(100%) rotate(10deg);
      opacity: 0;
    }
  </style>

  <div id="SplashPage-{{ section.id }}">
    
    <!-- Left Half -->
    <div class="splash-half splash-left">
      <div class="splash-content">
        {%- if section.settings.logo != blank -%}
          {{
            section.settings.logo
            | image_url: width: 600
            | image_tag: class: 'splash-logo', widths: '200, 300, 400, 600', loading: 'eager', alt: shop.name
          }}
        {%- else -%}
          <h1 style="color: #000; font-size: 3rem; text-transform: uppercase; font-weight: 900;">{{ shop.name }}</h1>
        {%- endif -%}

        <!-- Button class only, removing duplicate ID -->
        <button class="splash-enter-btn">
          {{ section.settings.btn_text }}
        </button>
      </div>
    </div>

    <!-- Right Half -->
    <div class="splash-half splash-right">
      <div class="splash-content">
        {%- if section.settings.logo != blank -%}
          {{
            section.settings.logo
            | image_url: width: 600
            | image_tag: class: 'splash-logo', widths: '200, 300, 400, 600', loading: 'eager', alt: shop.name
          }}
        {%- else -%}
          <h1 style="color: #000; font-size: 3rem; text-transform: uppercase; font-weight: 900;">{{ shop.name }}</h1>
        {%- endif -%}

        <button class="splash-enter-btn">
          {{ section.settings.btn_text }}
        </button>
      </div>
    </div>

  </div>

  <script>
    (function () {
      const splashSection = document.getElementById('SplashPage-{{ section.id }}');
      const storageKey = 'splash_seen';

      // 1. Check if already seen
      if (sessionStorage.getItem(storageKey)) {
        if(splashSection) splashSection.style.display = 'none';
        return; 
      }

      // 2. If not seen, lock scroll immediately
      document.body.style.overflow = 'hidden';

      // 3. Handle Enter Click on ALL buttons (since we have duplicates)
      // We use querySelectorAll because there are two buttons now (one in each half)
      const btns = splashSection.querySelectorAll('.splash-enter-btn');
      
      const triggerEnter = function() {
        // Trigger split animation
        splashSection.classList.add('splitting');

        // Unlock Scroll
        document.body.style.overflow = '';

        // Remember visitor
        sessionStorage.setItem(storageKey, 'true');

        // Remove from DOM after animation completes
        setTimeout(() => {
          splashSection.classList.add('hidden');
          splashSection.remove(); // Optional cleaner DOM
        }, 1000); // Matches CSS transition duration
      };

      btns.forEach(btn => {
        btn.addEventListener('click', triggerEnter);
      });

    })();
  </script>
{%- endif -%}

{% schema %}
{
  "name": "Splash Page",
  "tag": "section",
  "class": "section-splash-page",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_splash",
      "label": "Enable Splash Page",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo Image"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 200,
      "max": 1000,
      "step": 20,
      "unit": "px",
      "label": "Logo Width",
      "default": 400
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#fcb900"
    },
    {
      "type": "text",
      "id": "btn_text",
      "label": "Button Text",
      "default": "ENTER"
    },
    {
      "type": "color",
      "id": "btn_bg",
      "label": "Button Background",
      "default": "#d1d3d4"
    },
    {
      "type": "color",
      "id": "btn_text_color",
      "label": "Button Text Color",
      "default": "#000000"
    }
  ],
  "presets": [
    {
      "name": "Splash Page"
    }
  ]
}
{% endschema %}
