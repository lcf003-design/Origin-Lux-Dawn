{%- if section.settings.enable_splash -%}
  <script>
    // Immediate check to prevent flash of content if already seen
    if (sessionStorage.getItem('splash_seen')) {
      document.documentElement.classList.add('splash-seen');
    }
  </script>

  <style>
    /* Base state: Hidden if seen */
    html.splash-seen #shopify-section-{{ section.id }} {
      display: none !important;
    }

    #SplashPage-{{ section.id }} {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: transparent; 
      z-index: 2147483647;
      display: block; 
      visibility: visible;
      pointer-events: auto;
      overflow: hidden; /* contain sparks */
    }

    #SplashPage-{{ section.id }}.hidden {
      display: none;
    }

    /* The two halves */
    .splash-half {
      position: absolute;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: {{ section.settings.bg_color }};
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.6s ease-out;
      will-change: transform, opacity;
    }

    /* Left Half Clip Path & Animation */
    .splash-left {
      left: 0;
      clip-path: polygon(
        0% 0%, 50% 0%, 54% 20%, 46% 40%, 54% 60%, 46% 80%, 50% 100%, 0% 100%
      );
      z-index: 2;
    }

    /* Right Half Clip Path & Animation */
    .splash-right {
      right: 0;
      clip-path: polygon(
        50% 0%, 100% 0%, 100% 100%, 50% 100%, 46% 80%, 54% 60%, 46% 40%, 54% 20%
      );
      z-index: 2;
    }

    /* Content styling */
    .splash-content {
      text-align: center;
      max-width: 90%;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 40px;
    }

    .splash-logo {
      max-width: {{ section.settings.logo_width }}px;
      width: 100%;
      height: auto;
      display: block;
      animation: splashPulse 2s infinite ease-in-out;
      transform-origin: center;
    }

    @keyframes splashPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .splash-enter-btn {
      background-color: {{ section.settings.btn_bg }};
      color: {{ section.settings.btn_text_color }};
      border: 3px solid #000000;
      padding: 15px 50px;
      font-size: 1.2rem;
      font-weight: 700;
      text-transform: uppercase;
      cursor: pointer;
      transition: transform 0.2s, background-color 0.2s;
      letter-spacing: 2px;
      pointer-events: auto; 
      position: relative;
      z-index: 10; /* Above visual noise if needed */
    }

    .splash-enter-btn:hover {
      transform: scale(1.05);
      background-color: {{ section.settings.btn_bg | color_darken: 5 }};
    }

    /* --- SAWING ANIMATION (SHAKE) --- */
    #SplashPage-{{ section.id }}.sawing .splash-half {
      animation: violentShake 0.05s infinite;
    }

    @keyframes violentShake {
      0% { transform: translate(0, 0); }
      25% { transform: translate(-3px, 3px); }
      50% { transform: translate(3px, -3px); }
      75% { transform: translate(-3px, -3px); }
      100% { transform: translate(3px, 3px); }
    }

    /* --- SPLITTING STATE --- */
    #SplashPage-{{ section.id }}.splitting {
      pointer-events: none; 
    }

    /* Slower split transition for dramatic effect */
    #SplashPage-{{ section.id }}.splitting .splash-half {
      transition: transform 1.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 1.5s ease-out;
    }

    #SplashPage-{{ section.id }}.splitting .splash-left {
      transform: translateX(-150%) rotate(-15deg);
      opacity: 0;
    }

    #SplashPage-{{ section.id }}.splitting .splash-right {
      transform: translateX(150%) rotate(15deg);
      opacity: 0;
    }

    /* --- SPARKS --- */
    .spark {
      position: absolute;
      width: var(--size, 10px);
      height: var(--size, 10px);
      background: var(--color, #fff);
      border-radius: 50%;
      top: var(--top, 50%);
      left: 50%; 
      pointer-events: none;
      z-index: 2147483647; /* Max Z-Index to ensure visibility */
      opacity: 1;
      animation: flySparks 1s ease-out forwards;
      box-shadow: 0 0 10px var(--color, #fff), 0 0 20px var(--color, #fff);
    }

    @keyframes flySparks {
      0% {
        transform: translate(-50%, -50%) scale(1); /* Start centered */
        opacity: 1;
      }
      100% {
        transform: translate(var(--tx), var(--ty)) scale(0);
        opacity: 0;
      }
    }


  </style>

  <div id="SplashPage-{{ section.id }}">
    
    <!-- Left Half -->
    <div class="splash-half splash-left">
      <div class="splash-content">
        {%- if section.settings.logo != blank -%}
          {{
            section.settings.logo
            | image_url: width: 600
            | image_tag: class: 'splash-logo', widths: '200, 300, 400, 600', loading: 'eager', alt: shop.name
          }}
        {%- else -%}
          <h1 style="color: #000; font-size: 3rem; text-transform: uppercase; font-weight: 900;">{{ shop.name }}</h1>
        {%- endif -%}

        <button class="splash-enter-btn">
          {{ section.settings.btn_text }}
        </button>
      </div>
    </div>

    <!-- Right Half -->
    <div class="splash-half splash-right">
      <div class="splash-content">
        {%- if section.settings.logo != blank -%}
          {{
            section.settings.logo
            | image_url: width: 600
            | image_tag: class: 'splash-logo', widths: '200, 300, 400, 600', loading: 'eager', alt: shop.name
          }}
        {%- else -%}
          <h1 style="color: #000; font-size: 3rem; text-transform: uppercase; font-weight: 900;">{{ shop.name }}</h1>
        {%- endif -%}

        <button class="splash-enter-btn">
          {{ section.settings.btn_text }}
        </button>
      </div>
    </div>

  </div>

  <script>
    (function () {
      const splashSection = document.getElementById('SplashPage-{{ section.id }}');
      const storageKey = 'splash_seen';

      if (sessionStorage.getItem(storageKey)) {
        if(splashSection) splashSection.style.display = 'none';
        return; 
      }

      document.body.style.overflow = 'hidden';

      const btns = splashSection.querySelectorAll('.splash-enter-btn');
      
      const spawnSparks = () => {
        const count = 60; // MORE sparks
        // Bright, hot colors
        const colors = ['#ffffff', '#ffaa00', '#ffd700', '#ff4500', '#00ffff']; 

        for (let i = 0; i < count; i++) {
          const spark = document.createElement('div');
          spark.classList.add('spark');
          
          // Bigger particles
          const size = Math.random() * 8 + 4 + 'px'; // 4px to 12px
          const color = colors[Math.floor(Math.random() * colors.length)];
          const top = Math.random() * 100 + '%'; // Along the seam height
          
          // Wider explosion
          const tx = (Math.random() - 0.5) * 600 + 'px'; 
          const ty = (Math.random() - 0.5) * 300 + 'px';

          spark.style.setProperty('--size', size);
          spark.style.setProperty('--color', color);
          spark.style.setProperty('--top', top);
          spark.style.setProperty('--tx', tx);
          spark.style.setProperty('--ty', ty);

          splashSection.appendChild(spark);
        }
      };

      const triggerEnter = function(e) {
        // Prevent double clicks
        if (splashSection.classList.contains('sawing') || splashSection.classList.contains('splitting')) return;

        // 1. Start Sawing (Shake) - 2.5 seconds
        splashSection.classList.add('sawing');

        // 2. Wait for the "cut" to finish
        setTimeout(() => {
          splashSection.classList.remove('sawing');
          
          // 3. Trigger Split and Sparks
          splashSection.classList.add('splitting');
          spawnSparks(); // FIRE!

          document.body.style.overflow = '';
          sessionStorage.setItem(storageKey, 'true');

          // 4. Cleanup after split (1.5s transition + buffer)
          setTimeout(() => {
            splashSection.classList.add('hidden');
            splashSection.remove();
          }, 2000); 
        }, 2000); // Sawing duration
      };

      btns.forEach(btn => {
        btn.addEventListener('click', triggerEnter);
      });

    })();
  </script>
{%- endif -%}

{% schema %}
{
  "name": "Splash Page",
  "tag": "section",
  "class": "section-splash-page",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_splash",
      "label": "Enable Splash Page",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo Image"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 200,
      "max": 1000,
      "step": 20,
      "unit": "px",
      "label": "Logo Width",
      "default": 400
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#fcb900"
    },
    {
      "type": "text",
      "id": "btn_text",
      "label": "Button Text",
      "default": "ENTER"
    },
    {
      "type": "color",
      "id": "btn_bg",
      "label": "Button Background",
      "default": "#d1d3d4"
    },
    {
      "type": "color",
      "id": "btn_text_color",
      "label": "Button Text Color",
      "default": "#000000"
    }
  ],
  "presets": [
    {
      "name": "Splash Page"
    }
  ]
}
{% endschema %}
